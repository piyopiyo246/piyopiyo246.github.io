/*
YUI 3.11.0 (build d549e5c)
Copyright 2013 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("autocomplete-list",function(e,t){var n=e.Lang,r=e.Node,i=e.Array,s=e.UA.ie&&e.UA.ie<7,o=9,u="_CLASS_ITEM",a="_CLASS_ITEM_ACTIVE",f="_CLASS_ITEM_HOVER",l="_SELECTOR_ITEM",c="activeItem",h="alwaysShowList",p="circular",d="hoveredItem",v="id",m="item",g="list",y="result",b="results",w="visible",E="width",S="select",x=e.Base.create("autocompleteList",e.Widget,[e.AutoCompleteBase,e.WidgetPosition,e.WidgetPositionAlign],{ARIA_TEMPLATE:"<div/>",ITEM_TEMPLATE:"<li/>",LIST_TEMPLATE:"<ul/>",UI_EVENTS:function(){var t=e.merge(e.Node.DOM_EVENTS);return delete t.valuechange,delete t.valueChange,t}(),initializer:function(){var t=this.get("inputNode");if(!t){e.error("No inputNode specified.");return}this._inputNode=t,this._listEvents=[],this.DEF_PARENT_NODE=t.get("parentNode"),this[u]=this.getClassName(m),this[a]=this.getClassName(m,"active"),this[f]=this.getClassName(m,"hover"),this[l]="."+this[u],this.publish(S,{defaultFn:this._defSelectFn})},destructor:function(){while(this._listEvents.length)this._listEvents.pop().detach();this._ariaNode&&this._ariaNode.remove().destroy(!0)},bindUI:function(){this._bindInput(),this._bindList()},renderUI:function(){var t=this._createAriaNode(),n=this.get("boundingBox"),r=this.get("contentBox"),i=this._inputNode,o=this._createListNode(),u=i.get("parentNode");i.addClass(this.getClassName("input")).setAttrs({"aria-autocomplete":g,"aria-expanded":!1,"aria-owns":o.get("id")}),u.append(t),s&&n.plug(e.Plugin.Shim),this._ariaNode=t,this._boundingBox=n,this._contentBox=r,this._listNode=o,this._parentNode=u},syncUI:function(){this._syncResults(),this._syncVisibility()},hide:function(){return this.get(h)?this:this.set(w,!1)},selectItem:function(e,t){if(e){if(!e.hasClass(this[u]))return this}else{e=this.get(c);if(!e)return this}return this.fire(S,{itemNode:e,originEvent:t||null,result:e.getData(y)}),this},_activateNextItem:function(){var e=this.get(c),t;return e?t=e.next(this[l])||(this.get(p)?null:e):t=this._getFirstItemNode(),this.set(c,t),this},_activatePrevItem:function(){var e=this.get(c),t=e?e.previous(this[l]):this.get(p)&&this._getLastItemNode();return this.set(c,t||null),this},_add:function(t){var r=[];return i.each(n.isArray(t)?t:[t],function(e){r.push(this._createItemNode(e).setData(y,e))},this),r=e.all(r),this._listNode.append(r.toFrag()),r},_ariaSay:function(e,t){var r=this.get("strings."+e);this._ariaNode.set("text",t?n.sub(r,t):r)},_bindInput:function(){var e=this._inputNode,t,n,r;this.get("align")===null&&(r=this.get("tokenInput"),t=r&&r.get("boundingBox")||e,this.set("align",{node:t,points:["tl","bl"]}),!this.get(E)&&(n=t.get("offsetWidth"))&&this.set(E,n)),this._listEvents=this._listEvents.concat([e.after("blur",this._afterListInputBlur,this),e.after("focus",this._afterListInputFocus,this)])},_bindList:function(){this._listEvents=this._listEvents.concat([e.one("doc").after("click",this._afterDocClick,this),e.one("win").after("windowresize",this._syncPosition,this),this.after({mouseover:this._afterMouseOver,mouseout:this._afterMouseOut,activeItemChange:this._afterActiveItemChange,alwaysShowListChange:this._afterAlwaysShowListChange,hoveredItemChange:this._afterHoveredItemChange,resultsChange:this._afterResultsChange,visibleChange:this._afterVisibleChange}),this._listNode.delegate("click",this._onItemClick,this[l],this)])},_clear:function(){this.set(c,null),this._set(d,null),this._listNode.get("children").remove(!0)},_createAriaNode:function(){var e=r.create(this.ARIA_TEMPLATE);return e.addClass(this.getClassName("aria")).setAttrs({"aria-live":"polite",role:"status"})},_createItemNode:function(t){var n=r.create(this.ITEM_TEMPLATE);return n.addClass(this[u]).setAttrs({id:e.stamp(n),role:"option"}).setAttribute("data-text",t.text).append(t.display)},_createListNode:function(){var t=this.get("listNode")||r.create(this.LIST_TEMPLATE);return t.addClass(this.getClassName(g)).setAttrs({id:e.stamp(t),role:"listbox"}),this._set("listNode",t),this.get("contentBox").append(t),t},_getFirstItemNode:function(){return this._listNode.one(this[l])},_getLastItemNode:function(){return this._listNode.one(this[l]+":last-child")},_syncPosition:function(){this._syncUIPosAlign(),this._syncShim()},_syncResults:function(e){e||(e=this.get(b)),this._clear(),e.length&&(this._add(e),this._ariaSay("items_available")),this._syncPosition(),this.get("activateFirstItem")&&!this.get(c)&&this.set(c,this._getFirstItemNode())},_syncShim:s?function(){var e=this._boundingBox.shim;e&&e.sync()}:function(){},_syncVisibility:function(t){this.get(h)&&(t=!0,this.set(w,t)),typeof t=="undefined"&&(t=this.get(w)),this._inputNode.set("aria-expanded",t),this._boundingBox.set("aria-hidden",!t),t?this._syncPosition():(this.set(c,null),this._set(d,null),this._boundingBox.get("offsetWidth")),e.UA.ie===7&&e.one("body").addClass("yui3-ie7-sucks").removeClass("yui3-ie7-sucks")},_afterActiveItemChange:function(t){var n=this._inputNode,r=t.newVal,i=t.prevVal,s;i&&i._node&&i.removeClass(this[a]),r?(r.addClass(this[a]),n.set("aria-activedescendant",r.get(v))):n.removeAttribute("aria-activedescendant"),this.get("scrollIntoView")&&(s=r||n,(!s.inRegion(e.DOM.viewportRegion(),!0)||!s.inRegion(this._contentBox,!0))&&s.scrollIntoView())},_afterAlwaysShowListChange:function(e){this.set(w,e.newVal||this.get(b).length>0)},_afterDocClick:function(e){var t=this._boundingBox,n=e.target;n!==this._inputNode&&n!==t&&n.ancestor("#"+t.get("id"),!0)&&this.hide()},_afterHoveredItemChange:function(e){var t=e.newVal,n=e.prevVal;n&&n.removeClass(this[f]),t&&t.addClass(this[f])},_afterListInputBlur:function(){this._listInputFocused=!1,this.get(w)&&!this._mouseOverList&&(this._lastInputKey!==o||!this.get("tabSelect")||!this.get(c))&&this.hide()},_afterListInputFocus:function(){this._listInputFocused=!0},_afterMouseOver:function(e){var t=e.domEvent.target.ancestor(this[l],!0);this._mouseOverList=!0,t&&this._set(d,t)},_afterMouseOut:function(){this._mouseOverList=!1,this._set(d,null)},_afterResultsChange:function(e){this._syncResults(e.newVal
),this.get(h)||this.set(w,!!e.newVal.length)},_afterVisibleChange:function(e){this._syncVisibility(!!e.newVal)},_onItemClick:function(e){var t=e.currentTarget;this.set(c,t),this.selectItem(t,e)},_defSelectFn:function(e){var t=e.result.text;this._inputNode.focus(),this._updateValue(t),this._ariaSay("item_selected",{item:t}),this.hide()}},{ATTRS:{activateFirstItem:{value:!1},activeItem:{setter:e.one,value:null},alwaysShowList:{value:!1},circular:{value:!0},hoveredItem:{readOnly:!0,value:null},listNode:{writeOnce:"initOnly",value:null},scrollIntoView:{value:!1},strings:{valueFn:function(){return e.Intl.get("autocomplete-list")}},tabSelect:{value:!0},visible:{value:!1}},CSS_PREFIX:e.ClassNameManager.getClassName("aclist")});e.AutoCompleteList=x,e.AutoComplete=x},"3.11.0",{lang:["en","es","hu","it"],requires:["autocomplete-base","event-resize","node-screen","selector-css3","shim-plugin","widget","widget-position","widget-position-align"],skinnable:!0});
/*
YUI 3.11.0 (build d549e5c)
Copyright 2013 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("autocomplete-list-keys",function(e,t){function u(){e.before(this._bindKeys,this,"bindUI"),this._initKeys()}var n=40,r=13,i=27,s=9,o=38;u.prototype={_initKeys:function(){var e={},t={};e[n]=this._keyDown,t[r]=this._keyEnter,t[i]=this._keyEsc,t[s]=this._keyTab,t[o]=this._keyUp,this._keys=e,this._keysVisible=t},destructor:function(){this._unbindKeys()},_bindKeys:function(){this._keyEvents=this._inputNode.on("keydown",this._onInputKey,this)},_unbindKeys:function(){this._keyEvents&&this._keyEvents.detach(),this._keyEvents=null},_keyDown:function(){this.get("visible")?this._activateNextItem():this.show()},_keyEnter:function(e){var t=this.get("activeItem");if(!t)return!1;this.selectItem(t,e)},_keyEsc:function(){this.hide()},_keyTab:function(e){var t;if(this.get("tabSelect")){t=this.get("activeItem");if(t)return this.selectItem(t,e),!0}return!1},_keyUp:function(){this._activatePrevItem()},_onInputKey:function(e){var t,n=e.keyCode;this._lastInputKey=n,this.get("results").length&&(t=this._keys[n],!t&&this.get("visible")&&(t=this._keysVisible[n]),t&&t.call(this,e)!==!1&&e.preventDefault())}},e.Base.mix(e.AutoCompleteList,[u])},"3.11.0",{requires:["autocomplete-list","base-build"]});
/*
YUI 3.11.0 (build d549e5c)
Copyright 2013 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("autocomplete-plugin",function(e,t){function r(e){e.inputNode=e.host,!e.render&&e.render!==!1&&(e.render=!0),r.superclass.constructor.apply(this,arguments)}var n=e.Plugin;e.extend(r,e.AutoCompleteList,{},{NAME:"autocompleteListPlugin",NS:"ac",CSS_PREFIX:e.ClassNameManager.getClassName("aclist")}),n.AutoComplete=r,n.AutoCompleteList=r},"3.11.0",{requires:["autocomplete-list","node-pluginhost"]});
YUI.add("bo-selecta-transjax",function(a){a.transjax.add("bo-selecta",{me:'me',loading:'Loading...',uber_contact_list_view_profile:'View Profile',uber_contact_list_friend_and_family:'Friend &amp; Family',uber_contact_list_friend:'Friend',uber_contact_list_family:'Family',uber_contact_list_contact:'Contact',uber_contact_list_removed:'Removed',uber_contact_list_edit:'Edit',uber_contact_list_default_text:'screen name, real name, or email',uber_contact_list_max_results:'Showing [results_shown] of [total_results] results. <a href="[url]">See all...</a>',uber_contact_list_no_realname:'No real name given',bo_selecta_no_contacts_found:'No contacts found.',bo_selecta_no_members_found:'No members found.',bo_selecta_global_search_msg:'Search through all Flickr members?',bo_selecta_global_search_msg_2:'Search all Flickr members?',too_many_results:'We found too many results to display here. Please type a few more characters.'})},"0.0.1",{requires:["transjax-base"]});/*
YUI 3.11.0 (build d549e5c)
Copyright 2013 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("datasource-local",function(e,t){var n=e.Lang,r=function(){r.superclass.constructor.apply(this,arguments)};e.mix(r,{NAME:"dataSourceLocal",ATTRS:{source:{value:null}},_tId:0,transactions:{},issueCallback:function(e,t){var n=e.on||e.callback,r=n&&n.success,i=e.details[0];i.error=e.error||e.response.error,i.error&&(t.fire("error",i),r=n&&n.failure),r&&r(i)}}),e.extend(r,e.Base,{initializer:function(e){this._initEvents()},_initEvents:function(){this.publish("request",{defaultFn:e.bind("_defRequestFn",this),queuable:!0}),this.publish("data",{defaultFn:e.bind("_defDataFn",this),queuable:!0}),this.publish("response",{defaultFn:e.bind("_defResponseFn",this),queuable:!0})},_defRequestFn:function(e){var t=this.get("source"),r=e.details[0];n.isUndefined(t)&&(r.error=new Error("Local source undefined")),r.data=t,this.fire("data",r)},_defDataFn:function(e){var t=e.data,r=e.meta,i={results:n.isArray(t)?t:[t],meta:r?r:{}},s=e.details[0];s.response=i,this.fire("response",s)},_defResponseFn:function(e){r.issueCallback(e,this)},sendRequest:function(e){var t=r._tId++,n;return e=e||{},n=e.on||e.callback,this.fire("request",{tId:t,request:e.request,on:n,callback:n,cfg:e.cfg||{}}),t}}),e.namespace("DataSource").Local=r},"3.11.0",{requires:["base"]});
YUI.add("bo-selecta-global-search-datasource",function(a){a.BoSelectaGlobalSearchDataSource=function(b){a.BoSelectaGlobalSearchDataSource.superclass.constructor.apply(this,arguments);this.request=null;this.selector=b.selector};a.extend(a.BoSelectaGlobalSearchDataSource,a.DataSource.Local,{_defRequestFn:function(d){var c,b=this;if(this.request&&this.request.readyState<4){this.request.abort()}this.selector.loadingBox.setStyle("display","block");c=decodeURIComponent(d.request);this.request=a.flickrAPI.callMethod("flickr.people.search",{username:c},{success:function(j,p){var q=j.data,i=j.params;if(!b.selector.searchingGlobally){b.selector.loadingBox.setStyle("display","none");return}var l=[];var r=q.people.person;var k,h;for(var g=0,m=r.length;g<m;g++){h=r[g];k={n:h.nsid,e:h.email,u:h.username,r:h.realname,a:h.path_alias,d:h.friend,y:h.family,s:h.iconserver,f:h.iconfarm};k[0]=h.name;k.i=(k.f&&k.f!==0&&k.s&&k.s!==0)?"http://farm"+k.f+".static"+(a.config.flickr.dev?"-dev":"")+".flickr.com/"+k.s+"/buddyicons/"+k.n+".jpg":"http://www.flickr.com/images/buddyicon.gif";l.push(k)}if(l.length===0){if(!b.selector.hideNoContactMessage){l.push({message:a.transjax.get("bo-selecta","bo_selecta_no_members_found"),disableActive:true})}if(b.selector.zeroResultsMessages.length>0){var f,o,e;for(var g=0,m=b.selector.zeroResultsMessages.length;g<m;g++){f=b.selector.zeroResultsMessages[g];if(f.validator(b.selector)){l.push(f)}}}}b.selector.loadingBox.setStyle("display","none");b.fire("data",a.mix({data:l},d))},failure:function(g,f){var e=g.data,i=g.params,h=[];h.push({message:a.transjax.get("bo-selecta","too_many_results"),totalResultsMessage:true});b.selector.loadingBox.setStyle("display","none");b.fire("data",a.mix({data:h},d))}});return d.tId}})},"0.0.1",{requires:["bo-selecta-transjax","datasource-local","gallery-flickr-api"]});/*
YUI 3.11.0 (build d549e5c)
Copyright 2013 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("datasource-function",function(e,t){var n=e.Lang,r=function(){r.superclass.constructor.apply(this,arguments)};e.mix(r,{NAME:"dataSourceFunction",ATTRS:{source:{validator:n.isFunction}}}),e.extend(r,e.DataSource.Local,{_defRequestFn:function(e){var t=this.get("source"),n=e.details[0];if(t)try{n.data=t(e.request,this,e)}catch(r){n.error=r}else n.error=new Error("Function data failure");return this.fire("data",n),e.tId}}),e.DataSource.Function=r},"3.11.0",{requires:["datasource-local"]});
YUI.add("image-fader",function(b){function a(c,d){d=b.Lang.isNumber(d)?d:1;if(b.Lang.isString(c)){c=b.all(c)}c.on("load",function(g){var f;if(g.target.inDoc()){f=new b.Anim({node:g.target,to:{opacity:d},duration:0.2});f.run()}})}b.imageFader={attach:a}},"0.0.1",{requires:["node","anim"]});YUI.add("bo-selecta-3",function(b){b.BoSelecta3=function(d,c){c=c||{};this.showUsername=c.showUsername||true;this.showSubtitle=c.showSubtitle||false;this.showIcon=c.showIcon||false;this.showRelationship=c.showRelationship||false;this.usePersonMenu=c.usePersonMenu||false;this.linkUsernameToPhotostream=c.linkUsernameToPhotostream||false;this.linkSubtitle=c.linkSubtitle||false;this.showEditRelationshipLink=c.showEditRelationshipLink||false;this.searchOnUsername=c.searchOnUsername||true;this.searchOnRealname=c.searchOnRealname||false;this.searchOnEmail=c.searchOnEmail||false;this.searchOnPathAlias=c.searchOnPathAlias||false;this.searchUsingSoundex=c.searchUsingSoundex||false;this.includeUser=c.includeUser||false;this.includeAddressBook=c.includeAddressBook||false;this.maxResultsDisplayed=c.maxResultsDisplayed||5;this.globalMaxResultsDisplayed=c.globalMaxResultsDisplayed||10;this.showTotalResults=c.showTotalResults||false;this.disableMouseHover=c.disableMouseHover||false;this.selectFirstItem=c.selectFirstItem||false;this.hideNoContactMessage=c.hideNoContactMessage||false;this.zeroResultsMessages=c.zeroResultsMessages||[];this.preloadText=c.preloadText||"";this.defaultText=c.defaultText||"";this.loadingText=c.loadingText||b.transjax.get("bo-selecta","loading");this.focusOnFetch=c.focusOnFetch||false;this.fetchDataImmediately=c.fetchDataImmediately||false;this.allowNoContacts=c.allowNoContacts||false;this.allowFormSubmit=c.allowFormSubmit||false;this.respectCanTagFlag=c.respectCanTagFlag||false;this.apiURL=c.apiURL||b.config.flickr.people.api_url;this.enableGlobalSearch=c.enableGlobalSearch||false;this.defaultContainerWidth=c.defaultContainerWidth||250;this.minListWidth=c.minListWidth||228;this.maxListWidth=c.maxListWidth||500;this.loadTransparently=c.loadTransparently||false;if(this.includeUser){this.meString=b.transjax.get("bo-selecta","me").toLowerCase()}this.contacts=null;this.skipList={};this.shadowInit=false;this.fetchingData=false;this.haveTriedToFetchData=false;this.searchingGlobally=false;this._initHTML(d);this._initAutoComplete();if(this.fetchDataImmediately){this.fetchData()}};b.augment(b.BoSelecta3,b.EventTarget);b.BoSelecta3.prototype._initHTML=function(e){if(b.Lang.isString(e)){e=b.one(e)}if(!e instanceof b.Node){e=b.one("#BoSelecta_input")}this.inputField=e;this.container=this.inputField.get("parentNode");var c=this.container.all(".no-js-fallback");c.setStyle("display","none");this.container.addClass("bo-selecta-3");this.container.addClass("yui-skin-sam");this.containerId=b.stamp(this.container);this.inputField.addClass("input");var d=this.container.all(".loading");if(d.size()>0){this.loadingBox=d.item(0);this.loadingBox.setStyle("display",this.fetchDataImmediately&&!this.loadTransparently?"block":"none")}else{this.loadingBox=b.Node.create('<div class="loading">'+this.loadingText+"</div>");this.loadingBox.setStyle("display",this.fetchDataImmediately&&!this.loadTransparently?"block":"none");this.container.append(this.loadingBox)}this.inputField.set("disabled",false);this.inputField.set("value",this.preloadText);this.inputField.addClass("grey");this.inputField.on("focus",this.clearDefaultText,this,true);this.inputField.on("blur",function(f){if(this.inputField.get("value")===""){this.restoreDefaultText()}},this,true);if(!this.allowFormSubmit){this.form=this.container.ancestor("form",true);if(this.form){this.form.on("submit",function(f){f.halt()})}}this.maxInputWidth=parseInt(this.container.getStyle("width"),10)||this.defaultContainerWidth;this.defaultInputWidth=parseInt(this.inputField.getStyle("width"),10)||this.defaultContainerWidth};b.BoSelecta3.prototype._initAutoComplete=function(){var c=this;this.contactsCacheDataSource=new b.DataSource.Function({source:function(d){return c._searchContacts(d)}});this.globalSearchDataSource=new b.BoSelectaGlobalSearchDataSource({selector:this});this.autoComp=new b.AutoComplete({inputNode:this.inputField,source:this.contactsCacheDataSource,resultTextLocator:function(d){if(d&&d.u){return b.BoSelecta3.sanitizeString(d.u)}return""},resultFormatter:function(f,d,e){return c._formatResult(f,d,e)},activateFirstItem:this.selectFirstItem,queryDelay:0,render:true});this.autoComp.on("select",this._onItemSelectEvent,this,true);this.autoComp.on("query",this._handleQueryChange,this,true);this.autoComp.after("query",this._resizeListToFit,this,true);this.inputField.on("keydown",this._onInputFieldKeyDown,this,true);this.inputField.on("focus",function(f){var d=c.getQuery();if(d){c.autoComp.sendRequest(d)}});this.inputField.on("blur",function(d){var f=c.autoComp.get("visible");if(f){if(!c.resultsHideHandler){c.resultsHideHandle=b.one("document").on("click",function(g){if(g.target.ancestor(".yui3-aclist-item")){return}b.fire("BoSelecta:widgetBlur");b.fire("flickr-menus:hide");c.resultsHideHandle.detach()})}}else{b.fire("BoSelecta:widgetBlur")}});b.on("flickr-menus:hide",this.hideResults,this,true)};b.BoSelecta3.prototype._fetchData=function(){if(this.fetchingData){return}this.fetchingData=true;this.haveTriedToFetchData=true;this.fire("BoSelecta:dataFetchStart");if(!this.loadTransparently){this.inputField.setStyle("display","none");this.loadingBox.setStyle("display","block")}var c=this.apiURL;var d=this;var e={success:function(f,g,l){if(g.responseText==="-1"||g.responseText===""){if(d.allowNoContacts){d.contacts=[];if(!d.loadTransparently){d.restoreDefaultText();d.loadingBox.setStyle("display","none");d.inputField.setStyle("display","inline");if(d.inputField.get("value")===""||d.focusOnFetch){d.clear(true)}}d.fire("BoSelecta:dataFetchComplete")}else{e.failure()}return}var k=g.responseText.split("\u0002")[1];var p="\u0003";var m="\u0001";d.contacts=k.split(p);var i;for(var h=0,j=d.contacts.length;h<j;h++){i=d.contacts[h].split(m);if(i.length===0){continue}d.contacts[h]={};d.contacts[h].n=i[0];d.contacts[h].e=i[1];d.contacts[h].u=i[2];d.contacts[h].r=i[3];d.contacts[h].s=i[4];d.contacts[h].f=i[5];d.contacts[h].a=i[6];d.contacts[h].d=i[7];d.contacts[h].y=i[8];d.contacts[h].c=i[9];d.contacts[h].us=b.StringFilters.soundex(d.contacts[h].u);d.contacts[h].rs=b.StringFilters.soundex(d.contacts[h].r);d.contacts[h][0]=d.contacts[h].u}if(!d.loadTransparently){d.restoreDefaultText();d.loadingBox.setStyle("display","none");d.inputField.setStyle("display","inline");if(d.focusOnFetch){d.clear(true)}}d.fetchingData=false;d.fire("BoSelecta:dataFetchComplete")},failure:function(i,h,g){d.autoComp.destroy();if(d.form&&d.form.get("tagName").toLowerCase()==="form"){b.Event.purgeElement(d.form)}var f=d.inputField.get("parentNode");f.all(".no-js-fallback").setStyle("display","");d._destroy();d.fetchingData=false;d.fire("BoSelecta:dataError")}};if(!c){e.failure();return}b.io(c,{method:"GET",on:e})};b.BoSelecta3.prototype._destroy=function(d){var c=this.inputField.get("parentNode");b.Event.purgeElement(this.inputField);this.inputField.removeClass("grey");this.inputField.removeClass("yui-ac-input");this.inputField.set("value","");this.inputField.setStyle("display","");this.inputField.removeClass("input");if(d){this.inputField.remove()}this.loadingBox.remove();c.removeClass("yui-skin-sam");c.removeClass("bo-selecta-3")};b.BoSelecta3.prototype._searchContacts=function(g){var v,e=[],o,j=this;if(g===""||(g&&g===this.defaultText)){return e}if(g&&typeof g==="string"&&this.contacts){o=g;g=this._escapeForRegEx(g);g=b.StringFilters.substitute_equivalent_chars(g);var d=new RegExp(g,"i"),u=b.StringFilters.soundex(o),s,k;for(var q=0,t=this.contacts.length;q<t;q++){k=false;s=this.contacts[q];s.matched=null;if(s.n&&(!this.includeUser||o===this.meString)&&s.n===b.config.flickr.user.nsid){if(o===this.meString&&!this.skipList[s.n]){v=s}continue}if(this.skipList&&(this.skipList[s.n]||this.skipList[s.e])){continue}if(this.searchOnUsername&&s.u&&s.u.search(d)!==-1){k=true;s.matched="username";s.matchedPos=s.u.search(d)}if(!k&&this.searchOnRealname&&s.r&&s.r.search(d)!==-1){k=true;s.matched="realname";s.matchedPos=s.r.search(d)}if(!k&&this.searchOnEmail&&s.e&&g!=="@"&&s.e.search(d)!==-1){k=true;s.matched="email";s.matchedPos=s.e.search(d)}if(!k&&this.searchOnPathAlias&&s.a&&s.a.search(d)!==-1){k=true;s.matched="path_alias";s.matchedPos=s.a.search(d)}if(this.searchUsingSoundex){if(!k&&this.searchOnUsername&&s.us&&b.StringFilters.isEqualSoundex(s.us,u)){k=true;s.matched="username-soundex";s.matchedPos=(s.us===u)?0:b.StringFilters.isEqualSoundex(s.us,u)}if(!k&&this.searchOnRealname&&s.rs&&b.StringFilters.isEqualSoundex(s.rs,u)){k=true;s.matched="realname-soundex";s.matchedPos=(s.rs===u)?0:b.StringFilters.isEqualSoundex(s.rs,u)}}if(k){e.push(s)}}}if(e.length===0&&!(o===this.meString&&v)){if(!this.hideNoContactMessage){e.push({message:b.transjax.get("bo-selecta","bo_selecta_no_contacts_found"),notFoundLink:true,disableActive:true});if(this.enableGlobalSearch){e.push({globalSearchLink:true,query:o,message:b.transjax.get("bo-selecta","bo_selecta_global_search_msg")})}}if(this.zeroResultsMessages.length>0){var h,p,c;for(var q=0,t=this.zeroResultsMessages.length;q<t;q++){h=this.zeroResultsMessages[q];if(h.validator(this)){e.push(h)}}}}else{for(var q=0,t=e.length;q<t;q++){if(!e[q].n&&!e[q].u){for(var r=0,t=e.length;r<t;r++){if(q!==r&&e[q]&&e[r]&&e[q].e===e[r].e){delete e[q];break}}}}for(var q=0,t=e.length;q<t;){if(!e[q]){e.splice(q,1);t--}else{q++}}var i={username:0,realname:1,email:2,path_alias:3,"username-soundex":4,"realname-soundex":5};e.sort(function(x,m){var w=(x.n&&x.u)?"contact":"addressBookEntry";var y=(m.n&&m.u)?"contact":"addressBookEntry";if(w!==y){return(w==="contact")?-1:1}if(x.matchedPos===m.matchedPos){if(i[x.matched]===i[m.matched]){var z=x.u.charCodeAt(0),n=m.u.charCodeAt(0);if(z===n){return 0}else{if(z<n){return -1}else{return 1}}}else{if(i[x.matched]<i[m.matched]){return -1}else{return 1}}}else{if(x.matchedPos<m.matchedPos){return -1}else{return 1}}});if(o===this.meString&&v){v.matched="username";e.unshift(v)}var l=e.length;e=e.splice(0,this.maxResultsDisplayed);if(this.showTotalResults){var f="/search/people/?q=%s&m=names&see=all";e.push({message:b.transjax.get("bo-selecta","uber_contact_list_max_results").replace(/\[results_shown\]/,Math.min(e.length,this.maxResultsDisplayed)).replace(/\[total_results\]/,l).replace(/\[url\]/,f),totalResultsMessage:true})}}if(this.showEditRelationshipLink&&!this.relationshipLinksInitialized){b.use("contact-changer",function(m){j.container.delegate("click",function(n){m.contact_changer.show(n.target.getAttribute("data-nsid"));n.preventDefault()},".edit-rel a");j.relationshipLinksInitialized=true})}return e};b.BoSelecta3.prototype._formatResult=function(h,q,i){var j=this,s,l=[],v,e,d,m,c=!h?null:new RegExp(b.StringFilters.substitute_equivalent_chars(j._escapeForRegEx(h)),"gi"),k,g,o,u,r,f;if(!h){h=""}for(var p=0,t=q.length;p<t;p++){s=q[p].raw;if(!s){continue}if(s.globalSearchLink){v='<p class="bs-global-search-link bs-message bs-onclick"><span>'+s.message+"</span></p>";l.push(v);continue}if(s.totalResultsMessage){v='<p class="bs-message bs-total-results bs-disable-active"><span>'+s.message+"</span></p>";l.push(v);continue}if(s.message){v='<p class="bs-message'+(s.notFoundLink?"":" bs-onclick")+(s.disableActive?" bs-disable-active":"")+(s.className?" "+s.className:"")+'">'+s.message+"</p>";l.push(v);continue}m=(j.respectCanTagFlag&&s.c==="0")?' class="disabled"':"";if(s.e&&!s.u&&!s.n){if(!s.i){s.i="/images/icon_unread.gif"}e=j.showIcon?'<img src="'+s.i+'" width="16" height="16" class="BuddyIconX bs-email-icon">':"";d='<p email="'+s.e+'"'+m+'><span class="name name-email">'+e+'<strong class="username">'+a(j._sanitizeString(s.e),c)+'</strong></span><span class="relationship"></span></p>';l.push(d);continue}k=(s.a)?s.a:s.n;g=' / <a href="/people/'+k+'/">'+b.transjax.get("bo-selecta","uber_contact_list_view_profile")+"</a>";if(!s.i){s.i=(s.f&&s.f!==0&&s.s&&s.s!==0)?"http://farm"+s.f+".static"+(b.config.flickr.dev?"-dev":"")+".flickr.com/"+s.s+"/buddyicons/"+s.n+".jpg":"http://www.flickr.com/images/buddyicon.gif"}if(F.config.flickr.is_secure){s.i=s.i.replace("http:","https:")}o="";if(j.showRelationship){if(s.d==="1"&&s.y==="1"){o+=b.transjax.get("bo-selecta","uber_contact_list_friend_and_family")}else{if(s.d==="1"){o+=b.transjax.get("bo-selecta","uber_contact_list_friend")}else{if(s.y==="1"){o+=b.transjax.get("bo-selecta","uber_contact_list_family")}else{if(s.removed==="1"){o+='<em class="contact-removed">'+b.transjax.get("bo-selecta","uber_contact_list_removed")+"</em>"}else{if(j.searchingGlobally){o+=""}else{o+=b.transjax.get("bo-selecta","uber_contact_list_contact")}}}}}if(j.showEditRelationshipLink&&!j.searchingGlobally){o+=' <span class="edit-rel">(<a href="/people/'+k+'/relationship/" data-nsid="'+s.n+'">'+b.transjax.get("bo-selecta","uber_contact_list_edit")+"</a>)</span>"}}e=j.showIcon?'<img src="'+s.i+'" width="24" height="24" class="BuddyIconX fade-in" nsid="'+s.n+'">':"";e=j.linkUsernameToPhotostream?'<a href="/photos/'+k+'/">'+e+"</a>":e;u=j.showUsername?a(j._sanitizeString(s.u),c):"";u=j.linkUsernameToPhotostream?'<strong class="username"><a href="/photos/'+k+'/">'+u+"</a></strong>":'<strong class="username">'+u+"</strong>";r="";if(j.showSubtitle){if(!s.matched||s.matched==="realname"||s.matched==="realname-soundex"){r=s.r?a(j._sanitizeString(s.r),c):b.transjax.get("bo-selecta","uber_contact_list_no_realname")}else{if(s.matched==="username"||s.matched==="username-soundex"){r=s.r?j._sanitizeString(s.r):b.transjax.get("bo-selecta","uber_contact_list_no_realname")}else{if(s.matched==="email"){r=a(j._sanitizeString(s.e),c)}else{if(s.matched==="path_alias"&&s.a){r="flickr.com/people/"+a(j._sanitizeString(s.a),c)+"/"}}}}r=j.linkSubtitle?'<a title="'+b.transjax.get("bo-selecta","uber_contact_list_view_profile")+'" href="/people/'+k+'/" class="realname">'+r+"</a>":'<span class="realname">'+r+"</span>"}f=b.Node.create('<p nsid="'+s.n+'"'+m+'><span class="name">'+e+u+r+'</span><span class="relationship">'+o+"</span></p>");b.imageFader.attach(f.all("img"));l.push(f)}return l};function a(g,e){if(!g){return g}var c,d,f;g=b.StringFilters.unescape_entities(g,true);d=e?g.search(e):-1;if(d===-1){return b.BoSelecta3.sanitizeString(g)}c=g.match(e);f=d+c[0].length;return b.StringFilters.escape_entities(g.substring(0,d),true)+'<span class="term-highlight">'+b.StringFilters.escape_entities(g.substring(d,f),true)+"</span>"+b.StringFilters.escape_entities(g.substring(f,g.length),true)}b.BoSelecta3.prototype._resizeListToFit=function(j){var h,g,d=this.minListWidth,f=this.maxListWidth,i,k,c;if(j.type==="autocompleteList:query"||(j.type==="autocompleteList:visibleChange"&&j.newVal===true)){h=j.currentTarget;g=h.get("listNode");g.all("li p").each(function(e){i=e.one(".name");k=e.one(".relationship");if(i&&k){c=i.get("offsetWidth")+k.get("offsetWidth")+12;if(c>d){d=c}}});if(!this.baseListWidth){this.baseListWidth=h.get("width")}if(d>f){d=f}if(d<this.baseListWidth){d=this.baseListWidth}h.set("width",d)}};b.BoSelecta3.prototype._attachIconEvents=function(e){if(!personmenu_process_img||typeof personmenu_process_img!=="function"){return}var g=e.all("img"),d;for(var f=0,c=g.size();f<c;f++){d=b.Node.getDOMNode(g.item(f));if(g.item(f).hasClass("BuddyIconX")){d.nsid=g.item(f).getAttribute("nsid");personmenu_process_img(d)}}};b.BoSelecta3.prototype._useGlobalSearch=function(d){var c=this;this.searchingGlobally=true;if(d){this.inputField.set("value",decodeURIComponent(d))}this.autoComp.set("source",this.globalSearchDataSource);this.autoComp.set("minQueryLength",2);this.autoComp.set("maxResultsDisplayed",this.globalMaxResultsDisplayed);this.autoComp.set("queryDelay",600);this.loadingBox.addClass("loading-global").removeClass("loading");this.loadingBox.set("innerHTML","");this.globalSearchRemover=this.inputField.on("keyup",function(f){if(c.inputField.get("value")===""){c.globalSearchRemover.detach();c._useContactsCache()}});d=this.getQuery();this.autoComp.sendRequest(d)};b.BoSelecta3.prototype._useContactsCache=function(c){this.searchingGlobally=false;if(c){this.inputField.set("value",decodeURIComponent(c))}this.autoComp.set("source",this.contactsCacheDataSource);this.autoComp.set("minQueryLength",1);this.autoComp.set("maxResultsDisplayed",0);this.autoComp.set("queryDelay",0)};b.BoSelecta3.prototype._onItemSelectEvent=function(f,d){var c=f.result.raw;if(c.message){if(c.globalSearchLink){this._useGlobalSearch(c.query)}else{if(c.onclick&&typeof c.onclick==="function"){c.onclick(f,this)}else{this.clear()}}f.preventDefault();return}this.fire("BoSelecta:resultSelect",c,c.query);if(this.searchingGlobally){this._useContactsCache()}};b.BoSelecta3.prototype._handleQueryChange=function(c){this.fire("BoSelecta:queryChange",c.query)};b.BoSelecta3.prototype._onInputFieldKeyDown=function(d){if(d.keyCode===13&&this.autoComp){var f=false;if(this.autoComp._oCurItem){var c=b.one(this.autoComp._oCurItem).all("p");if(c.size()>0){f=(c.item(0).hasClass("bs-message")&&!c.item(0).hasClass("bs-onclick"))}}if(!this.autoComp._oCurItem||f){this.fire("BoSelecta:inputEnter")}}};b.BoSelecta3.prototype._sanitizeString=function(c){c=c.replace(/</g,"&lt;").replace(/>/g,"&gt;");return c};b.BoSelecta3.prototype._unsanitizeString=function(c){c=c.replace(/\&lt;/g,"<").replace(/\&gt;/g,">");return c};b.BoSelecta3.prototype._escapeForRegEx=function(c){c=decodeURIComponent(c);c=c.replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,"\\*").replace(/\$/g,"\\$").replace(/\^/g,"\\^").replace(/\?/g,"\\?");c=c.replace(/\|/g,"\\|").replace(/\+/g,"\\+").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\[/g,"\\[").replace(/\]/g,"\\]");return c};b.BoSelecta3.prototype.fetchData=function(){if(!this.contacts&&!this.haveTriedToFetchData){this._fetchData()}};b.BoSelecta3.prototype.refreshData=function(){this._fetchData()};b.BoSelecta3.prototype.hideResults=function(){if(this.autoComp&&this.autoComp.hide){this.autoComp.hide()}if(this.resultsHideHandle&&this.resultsHideHandle.detach){this.resultsHideHandle.detach()}};b.BoSelecta3.prototype.clear=function(c){this.inputField.removeClass("grey");this.inputField.set("value","");if(c){try{this.inputField.focus()}catch(d){}}this.hideResults()};b.BoSelecta3.prototype.clearDefaultText=function(c){if(this.inputField.hasClass("grey")){this.clear(c)}};b.BoSelecta3.prototype.restoreDefaultText=function(){this.clear();this.inputField.addClass("grey");this.inputField.set("value",this.defaultText);this.inputField.blur()};b.BoSelecta3.prototype.getQuery=function(){if(this.inputField.hasClass("grey")){return""}return this.inputField.get("value")};b.BoSelecta3.prototype.refreshResults=function(){if(this.autoComp&&this.getQuery()){this.autoComp.sendRequest(this.getQuery())}};b.BoSelecta3.prototype.skipContact=function(c){this.skipList[(c.n?c.n:c.e)]=true};b.BoSelecta3.prototype.unskipContact=function(c){this.skipList[(c.n?c.n:c.e)]=false};b.BoSelecta3.prototype.unskipAll=function(){this.skipList={}};b.BoSelecta3.prototype.showInFieldLoading=function(){this.loadingBox.addClass("loading-global");this.loadingBox.removeClass("loading");this.loadingBox.setStyle("display","block")};b.BoSelecta3.prototype.hideInFieldLoading=function(){this.loadingBox.setStyle("display","")};b.BoSelecta3.prototype.destroy=function(){this._destroy(true)};b.BoSelecta3.sanitizeString=b.BoSelecta3.prototype._sanitizeString;b.BoSelecta3.unsanitizeString=b.BoSelecta3.prototype._unsanitizeString},"0.0.1",{requires:F.config.modules["bo-selecta-3"].requires||[],optional:F.config.modules["bo-selecta-3"].optional||[]});YUI.add("share-this-v3-service-email-transjax",function(a){a.transjax.add("share-this-v3-service-email",{email_field_default_text:"screen name, real name, or email",send_an_email:"Send an email to this address",no_realname:"No real name given",sharing_email_error:"Oops! That doesn't look like a real email address. Try again?",sharing_no_contact:"Hmm... we couldn't find %s in your contacts list. Do you want to try entering their email address instead?"})},"0.0.1",{requires:["transjax-base"]});YUI.add("share-this-v3-service-twitter-transjax",function(a){a.transjax.add("share-this-v3-service-twitter",{over_limit_1:"%s whoa!",over_limit_5:"%s too much!",over_limit_10:"%s less is more!",over_limit_20:"%s way over!",over_limit_30:"%s booooring!"})},"0.0.1",{requires:["transjax-base"]});YUI.add("share-this-v3-services",function(e){var d={};function c(f){d[f.name]=f}function b(){return d}function a(g){var f,h;for(f in d){if(d.hasOwnProperty(f)){if(d[f].id===g){h=true;break}}}return h?d[f]:undefined}e.shareThisV3Services={add_service:c,get_services:b,get_service:a}},"0.0.1",{requires:[]});YUI.add("share-this-v3-service-blogger",function(b){var a=b.shareThisV3Services;if(!a){b.log("Y.shareThisV3Services null/undefined?")}else{a.add_service({name:"blogger",id:3,setup_url:"/share.gne?action=setup&service_type_id=3",use_popup:true,popup_params:{width:780,height:480},default_text:null,on_window_closed:function(){var c=b.shareThisV3Dialog.get_current_service();b.log("auth (maybe) complete for "+c.name);b.shareThisV3Dialog.fetch_sharing_fragment({on_complete:function(){b.shareThisV3Dialog.refresh_dialog_state();b.fire("shareDialog:servicesAuthComplete")}})},on_show_screen:{setup:function(){b.log("blogger: setup screen")},setup_choose_a_blog:function(){b.log("blogger: setup_choose_a_blog()")},share:function(){b.log("blogger: share screen");var d=b.shareThisV3Dialog.get_current_service(),e=b.shareThisV3Dialog.service_helpers;b.global_dialog.show();var c=b.one("#blogger-text");d.default_text=c.getAttribute("data-default-text");c.on("focus",b.shareThisV3Dialog.service_helpers.maybeClearText);c.on("blur",b.shareThisV3Dialog.service_helpers.maybeRestoreText);e.addDescriptionEvents(b.one("#share-this-v3-dialog .add-object-description"),c)},share_confirmblog:function(){b.log("share_confirmblog()");b.global_dialog.show()}},on_auth_failed:function(){b.log("on_auth_failed");set_dialog_state("state-setup state-setup-error");b.global_dialog.reposition()},on_submit_form:{share:function(){b.shareThisV3Dialog.service_helpers.maybeClearText({target:b.one("#blogger-text")})},share_chooseblog:function(){b.global_dialog.hide();b.global_dialog.set_loading(true)}},misc:{maybe_highlight_endpoint:function(f){var g=f.target,h=f.target.getAttribute("data-default-url"),c=f.target.get("value"),d=c.indexOf(h);if(d!==-1){b.shareThisV3Dialog.service_helpers.setSelectionRange(b.Node.getDOMNode(g),d,d+h.length)}}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-email",function(c){c.config.flickr.user.apiURL=null;var q=c.shareThisV3Services,o,h={},v=false,p="#share-form-email",k=false;function a(){if(!v){c.shareThisV3Dialog.service_helpers.disableForm(c.one(p));v=true}}function g(){if(v){c.shareThisV3Dialog.service_helpers.enableForm(c.one(p));v=false}}function u(){var x=c.shareThisV3Dialog.service_helpers,z=x.is_guestpass_required(),y=x.is_guestpass_automatic(),w=s(),A=false;if(!z||y){if(w){g()}else{a()}}else{if(!w){a()}else{A=x.is_guestpass_chosen();if(A){g()}else{a()}}}}function s(){var w=c.one("#sharing-email-input"),y=w.get("value"),x=(m(y)||j());return x}function n(){var z=b();var x=c.shareThisV3Dialog.get_form_params();z=c.merge(z,x);var w=c.one("#email-text");var y=w.get("value");if(y&&y!==w.getAttribute("data-default-text")){z.message_text=y}return z}if(!q){c.log("Y.shareThisV3Services null/undefined?")}else{q.add_service({name:"email",id:130,default_text:null,on_show_screen:{share:function(){var z=c.shareThisV3Dialog.service_helpers,x=c.one("#sharing-email-input"),y=c.one("#email-text"),w=c.shareThisV3Dialog.get_current_service();k=false;w.default_text=y.getAttribute("data-default-text");y.on("focus",z.maybeClearText);y.on("blur",z.maybeRestoreText);c.one("#to-flickr").set("value","");c.one("#to-email").set("value","");h={};add_by_email=function(A){if(r()){i();c.global_dialog.reposition()}};o=new c.BoSelecta3(x,{showSubtitle:true,showIcon:true,maxResultsDisplayed:4,includeAddressBook:!!(c.config.flickr.user.nsid),searchOnUsername:true,searchOnRealname:true,searchOnEmail:true,searchOnPathAlias:true,showTotalResults:true,allowNoContacts:true,defaultText:c.transjax.get("share-this-v3-service-email","email_field_default_text"),purgeFormOnDataFailure:false,focusOnFetch:true,fetchDataImmediately:true,selectFirstItem:true,allowFormSubmit:false,hideNoContactMessage:true,enableGlobalSearch:false,zeroResultsMessages:[{message:"<span>"+c.transjax.get("share-this-v3-service-email","send_an_email")+"</span>",className:"bs-send-email-link",onclick:add_by_email,validator:function(A){var B=A.getQuery(),C=(t(B)&&m(B)&&!A.searchingGlobally);return C}}],apiURL:(c.config.flickr.user.nsid?x.getAttribute("data-api-url"):null)});o.on("BoSelecta:resultSelect",d);o.on("BoSelecta:resultClick",d);c.one(p).one('.Butt[type="submit"]').on("mousedown",function(A){k=true});c.one(p).on("submit",i);if(z.is_guestpass_required()){c.all('#guestpass-box input[type="checkbox"]').on("click",u)}v=false;a();c.one("#sharing-email-input").on("keyup",u);c.delegate("click",f,"#bo-selecta-results-box","a.delete-x")}},on_submit_form:{share:function(w){var x=b();c.one("#to-flickr").set("value",x.to_flickr||null);c.one("#to-email").set("value",x.to_email||null);if(c.config.flickr.flags.enable_grease&&!c.config.flickr.user.nsid){w.preventDefault();return false}else{c.shareThisV3Dialog.service_helpers.maybeClearText({target:c.one("#email-text")})}}}})}function d(w){if(typeof h[(w.n?w.n:w.e)]==="undefined"){h[(w.n?w.n:w.e)]=w;o.skipContact(w);if(F.config.flickr.is_secure){w.i=w.i.replace("http:","https:")}var x=c.one("#bo-selecta-results-box"),z,y;liEl=document.createElement("li");liEl.innerHTML=(w.n)?'<p nsid="'+w.n+'"><span class="name"><img src="'+w.i+'" width="24" height="24" class="BuddyIconX" nsid="'+w.n+'" id="pt-icon-'+w.n+'"><strong class="username">'+o._sanitizeString(w.u)+'</strong><span class="realname">'+(w.r?o._sanitizeString(w.r):c.transjax.get("share-this-v3-service-email","no_realname"))+'</span></span><span class="controls"><a href="#" class="delete-x" class="pt-remove" id="pt-remove-'+w.n+'"><span>[x]</span></a></span></p>':'<p email="'+o._sanitizeString(w.e)+'" class="email-contact"><span class="name"><img src="'+w.i+'" width="16" height="16" class="BuddyIconX bs-email-icon"><strong class="username email">'+o._sanitizeString(w.e)+'</strong></span><span class="controls"><a href="#" class="delete-x" class="pt-remove" id="pt-remove-'+o._sanitizeString(w.e)+'"><span>[x]</span></a></span></p>';x.appendChild(liEl);x.addClass("not-empty");if(c.is_ie){x.setStyle("display","block")}y=x.all("li.last");if(y){y.each(function(){this.removeClass("last")})}c.one(liEl).addClass("last");if(x.getElementsByTagName("li").length>5){x.addClass("overflow")}x.set("scrollTop",x.get("scrollHeight"))}setTimeout(function(){o.clear(true)},1);u();c.global_dialog.reposition();if(typeof e!=="undefined"){e.preventDefault()}return false}function i(B){var C=o.getQuery(),x=c.one("#sharing-email-input"),A,w,z,y;w=C.replace(/([\;\s<>]+)/g,",");A=w.split(",");if(!A.length){return l(false,B)}else{for(z=0,y=A.length;z<y;z++){if(A[z]){x.set("value",A[z]);l(true,B)}}x.set("value","")}}function l(z,B){var A=o.getQuery();if(r(z)){var x={e:o.getQuery()};if(typeof h[x.e]==="undefined"){h[x.e]=x;var y=c.one("#bo-selecta-results-box");var w=document.createElement("li");w.innerHTML='<p email="'+o._sanitizeString(x.e)+'" class="email-contact"><span class="name"><img src="/images/icon_unread.gif" width="16" height="16" class="BuddyIconX bs-email-icon"><strong class="username email">'+o._sanitizeString(x.e)+'</strong></span><span class="controls"><a href="#" class="pt-remove delete-x" id="pt-remove-'+o._sanitizeString(x.e)+'"><span>[x]</span></a></span></p>';y.appendChild(w);y.addClass("not-empty");if(c.UA.ie){y.setStyle("display","block")}y.all("li").removeClass("last");c.one(w).addClass("last");if(y.all("li").size()>5){y.addClass("overflow")}y.set("scrollTop",y.get("scrollHeight"));o.clear(true)}u()}if(B&&A&&!k){B.halt();return false}else{if(c.config.flickr.flags.enable_grease&&!c.config.flickr.user.nsid){c.use("grease",function(D){var C=n();D.grease.shareV3(C);D.grease.authenticate(function(E){})});if(B){B.preventDefault()}return false}}}function m(w){var x=/[a-z_0-9\.\-\+\']+@[a-z_0-9\.\-\+]+\.[a-z]/i;return x.test(w)}function t(x){var w=/\.|@/;return w.test(x)}function r(w){var x=o.getQuery();if(x!==""){if(!m(x)){var y=c.config.flickr.flags.enable_grease?c.transjax.get("share-this-v3-service-email","sharing_email_error",x):c.transjax.get("share-this-v3-service-email","sharing_no_contact",x);if(t(x)){y=c.transjax.get("share-this-v3-service-email","sharing_email_error")}if(!w){alert(y)}return false}else{return true}}return false}function f(A){A.halt();var z=A.target.ancestor("p");var B=z.getAttribute("nsid")?z.getAttribute("nsid"):z.getAttribute("email");o.unskipContact(h[B]);delete h[B];var w=z.get("parentNode");var x=c.one("#bo-selecta-results-box");x.removeChild(w);o.clear(true);var y=x.all("li");if(y.size()===0){x.removeClass("not-empty");if(c.is_ie){x.setStyle("display","")}}else{y.removeClass("last");if(y.size()){x.all("li:list-child").addClass("last")}}if(y.size()<=5){x.removeClass("overflow")}u()}function b(){var z={},x=[],y=[],w;for(w in h){if(h.hasOwnProperty(w)){if(h[w].n){y.push(h[w].n)}else{if(h[w].e){x.push(h[w].e)}}}}if(x.length>0){z.to_email=x.join()}if(y.length>0){z.to_flickr=y.join()}return z}function j(){var w=b();return(w.to_email||w.to_flickr)}},"0.0.1",{requires:F.config.modules["share-this-v3-service-email"].requires||[],optional:F.config.modules["share-this-v3-service-email"].optional||[]});YUI.add("share-this-v3-service-facebook",function(a){var g=a.shareThisV3Services;var b,c,l,o,h,k,e;var m=false;var n="#share-form-facebook";var f="#guestpass-box";var d=false;function j(){c=a.one(n);l=a.one(f);o=a.shareThisV3Dialog.service_helpers.is_guestpass_required();h=a.shareThisV3Dialog.service_helpers.is_guestpass_automatic();k=null;e=0;if(!o||h){if(m){a.shareThisV3Dialog.service_helpers.enableForm(c);m=false}return false}if(l){k=l.all('input[type="checkbox"]');if(k){k.each(function(){if(this.get("checked")){e++}});if(e&&m){a.shareThisV3Dialog.service_helpers.enableForm(c);m=false}else{if(!e&&!m){a.shareThisV3Dialog.service_helpers.disableForm(c);m=true}}}else{}}}function i(){a.all(f+' input[type="checkbox"]').on("change",j)}if(!g){a.log("Y.shareThisV3Services null/undefined?")}else{g.add_service({name:"facebook",id:128,setup_url:"/share.gne?action=setup&service_type_id=128",use_popup:true,signed_out_url:"/share.gne?action=signedOutShare&service_type_id=128",popup_params:{width:780,height:500},default_text:null,setup_only:false,share_signed_out:function(s){var q=a.shareThisV3Dialog.get_current_service(),p="&"+a.shareThisV3Dialog.get_share_this_data(true).join("&"),r=q.signed_out_url+"&"+p;a.shareThisV3Dialog.webCirca1999(r,{width:640,height:320});return false},on_window_closed:function(){var p=a.shareThisV3Dialog.get_current_service();a.log("auth (maybe) complete for "+p.name);if(p.setup_only){a.shareThisV3Dialog.service_helpers.setupOnly()}else{a.shareThisV3Dialog.fetch_sharing_fragment()}},on_auth_failed:function(){a.log("D'oh, auth did not work, or something. Retry?")},on_show_screen:{share:function(){if(m){m=false;a.shareThisV3Dialog.service_helpers.enableForm(c)}var p=a.one("#facebook-text");var q=a.shareThisV3Dialog.get_current_service();q.default_text=p.getAttribute("data-default-text");p.on("focus",a.shareThisV3Dialog.service_helpers.maybeClearText);p.on("blur",a.shareThisV3Dialog.service_helpers.maybeRestoreText);i();j();a.log("on_show_screen.share()")},error:function(){a.fire("shareDialog:servicesAuthComplete")}},on_submit_form:{share:function(){a.shareThisV3Dialog.service_helpers.maybeClearText({target:a.one("#facebook-text")})}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-livejournal",function(d){var b=d.shareThisV3Services;var c,e,a;if(!b){d.log("Y.shareThisV3Services null/undefined?")}else{b.add_service({name:"livejournal",id:5,use_setup_dialog:true,default_text:null,on_show_screen:{setup:function(){d.log("livejournal: setup screen");var f=d.shareThisV3Dialog.get_current_service();c=d.one("#lj-setup-api-endpoint");e=d.one("#lj-setup-username");a=d.one("#lj-setup-password");if(a){a.on("focus",f.misc.set_password_field)}if(e){e.on("keypress",f.misc.update_endpoint_url);e.on("keyup",f.misc.update_endpoint_url)}},setup_choose_a_blog:function(){d.log("livejournal: setup_choose_a_blog()")},share:function(){var g=d.shareThisV3Dialog.get_current_service(),h=d.shareThisV3Dialog.service_helpers,f=d.one("#livejournal-text");g.default_text=f.getAttribute("data-default-text");f.on("focus",h.maybeClearText);f.on("blur",h.maybeRestoreText);h.addDescriptionEvents(d.one("#share-this-v3-dialog .add-object-description"),f)},password:function(){var g=d.shareThisV3Dialog.get_current_service(),f=d.one("#lj-setup-password");if(f){f.focus()}}},on_submit_form:{share:function(){d.shareThisV3Dialog.service_helpers.maybeClearText({target:d.one("#livejournal-text")})}},on_auth_failed:function(){d.shareThisV3Dialog.set_dialog_state("state-setup state-setup-error");d.global_dialog.reposition()},misc:{update_endpoint_url:function(f){c.set("value",c.getAttribute("data-default-url").replace("%s",e.get("value")))},set_password_field:function(f){var g=f.target;if(g){d.shareThisV3Dialog.service_helpers.setPasswordField(g)}}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-pinterest",function(b){var a=b.shareThisV3Services;if(!a){b.log("Y.shareThisV3Services null/undefined?")}else{a.add_service({name:"pinterest",id:132,use_popup:true,signed_out_url:"/share.gne?action=signedOutShare&service_type_id=132",share_signed_out:function(g){var d=b.shareThisV3Dialog.get_current_service(),c="&"+b.shareThisV3Dialog.get_share_this_data(true).join("&"),f=d.signed_out_url+c;b.shareThisV3Dialog.webCirca1999(f,{width:685,height:520});b.fire("flickr-menus:hide");return false}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-tumblr",function(b){var a=b.shareThisV3Services;if(!a){b.log("Y.shareThisV3Services null/undefined?")}else{a.add_service({name:"tumblr",id:12,setup_url:"/share.gne?action=setup&service_type_id=12",use_popup:true,popup_params:{width:920,height:600},signed_out_url:"/share.gne?action=signedOutShare&service_type_id=12",default_text:null,share_signed_out:function(g){var d=b.shareThisV3Dialog.get_current_service(),c="&"+b.shareThisV3Dialog.get_share_this_data(true).join("&"),f=d.signed_out_url+c;b.shareThisV3Dialog.webCirca1999(f,{width:788,height:375});return false},on_window_closed:function(){var c=b.shareThisV3Dialog.get_current_service();b.log("auth (maybe) complete for "+c.name);if(c.setup_only){b.shareThisV3Dialog.fetch_sharing_fragment()}else{b.shareThisV3Dialog.fetch_sharing_fragment()}},on_auth_failed:function(){b.log("D'oh, auth did not work, or something. Retry?")},on_show_screen:{share:function(){b.log("on_show_screen:share");b.global_dialog.show();var d=b.shareThisV3Dialog.get_current_service(),f=b.shareThisV3Dialog.service_helpers,c=b.one("#tumblr-text"),e=b.one("#tumblr-butt-post");if(!c){b.log("Warn: could not find textarea");return false}f.addDescriptionEvents(b.one("#share-this-v3-dialog .add-object-description"),c);f.addMoreOptionsEvents();d.default_text=c.getAttribute("data-default-text");c.on("focus",f.maybeClearText);c.on("blur",f.maybeRestoreText)}},on_submit_form:{share:function(){b.shareThisV3Dialog.service_helpers.maybeClearText({target:b.one("#tumblr-text")})},setup_choose_a_blog:function(){b.global_dialog.hide();b.global_dialog.set_loading(true)}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-twitter",function(b){var a=b.shareThisV3Services;if(!a){b.log("Y.shareThisV3Services null/undefined?")}else{a.add_service({name:"twitter",id:9,setup_url:"/share.gne?action=setup&service_type_id=9",use_popup:true,popup_params:{width:780,height:500},signed_out_url:"/share.gne?action=signedOutShare&service_type_id=9",max_tweet_length:140,default_text:null,flickr_shorturl_length:null,over_limit_classname:"over-limit",share_signed_out:function(g){var d=b.shareThisV3Dialog.get_current_service(),c="&"+b.shareThisV3Dialog.get_share_this_data(true).join("&"),f=d.signed_out_url+c;b.shareThisV3Dialog.webCirca1999(f,{width:780,height:425});return false},on_window_closed:function(){var c=b.shareThisV3Dialog.get_current_service();b.log("auth (maybe) complete for "+c.name);if(c.setup_only){b.shareThisV3Dialog.service_helpers.setupOnly()}else{b.shareThisV3Dialog.fetch_sharing_fragment()}},on_auth_failed:function(){b.log("D'oh, auth did not work, or something. Retry?")},on_show_screen:{share:function(){b.log("on_show_screen:share");var k=b.shareThisV3Dialog.get_current_service();var l=b.one("#tweet-text"),c=b.one("#tweet-characters"),m=null,g=false,h,n,i={"1":"over_limit_1","5":"over_limit_5","10":"over_limit_10","20":"over_limit_20","30":"over_limit_30"},j=b.one("#twitter-butt-post");if(!l){b.log("Warn: could not find textarea");return false}function o(r,s,p){if(r._node.setSelectionRange){r._node.focus();r._node.setSelectionRange(s,p)}else{if(r._node.createTextRange){var q=r._node.createTextRange();q.collapse(true);q.moveStart("character",s);q.moveEnd("character",p);q.select()}}}var e=b.Lang.trim(b.one("#tweet-shorturl").get("title"));var f=l.get("value");l.set("text",f+" "+e);o(l,0,f.length);k.max_tweet_length=parseInt(l.getAttribute("data-available-chars"),10);k.default_text=l.getAttribute("data-default-text");function d(){var q=parseInt(l.get("value").length,10),p=(140-parseInt(q,10)),r;if(!isNaN(p)&&p!==m){m=p;if(p<0&&!g){g=true;c.addClass(k.over_limit_classname);j.replaceClass("Butt","DisabledButt");j.set("disabled",true)}else{if(p>=0&&g){g=false;c.removeClass(k.over_limit_classname);j.replaceClass("DisabledButt","Butt");j.set("disabled",false);c.setStyle("fontSize","11px")}}if(p>=0){c.set("innerHTML",p)}else{r=Math.abs(p);if(r>=1&&r<5){h="1";n=1}else{if(r>=5&&r<10){h="5";n=1.25}else{if(r>=10&&r<20){h="10";n=1.5}else{if(r>=20&&r<30){h="20";n=1.75}else{if(r>=30){h="30";n=2}}}}}over_limit_string=b.transjax.get("share-this-v3-service-twitter",i[h],p);c.set("innerHTML",over_limit_string);c.setStyle("fontSize",Math.min(32,parseInt(11*n+(r>30?(r-30)/10:0),10))+"px")}}else{if(isNaN(p)){c.setStyle("display","none")}}b.one("#tweet-shorturl a").on("click",function(u){var t=/([^\s^]*)([http\:\/\/]+)?flic\.kr([\/a-zA-Z0-9]+)?([^\s$]*)/;if(l.get("value").search(t)>0){l.set("value",l.get("value").replace(t,e))}else{l.set("value",l.get("value")+" "+e)}o(l,l.get("value").length,l.get("value").length);u.preventDefault()});var s=new RegExp("(^|\\s)"+e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"($|\\s)");if(l.get("value").search(s)<0){b.one("#tweet-shorturl span").show();j.replaceClass("Butt","DisabledButt");j.set("disabled",true)}else{b.one("#tweet-shorturl span").hide();if(!g){j.replaceClass("DisabledButt","Butt");j.set("disabled",false)}}}b.shareThisV3Dialog.service_helpers.addMoreOptionsEvents();l.on("focus",b.shareThisV3Dialog.service_helpers.maybeClearText);l.on("focus",d);l.on("blur",b.shareThisV3Dialog.service_helpers.maybeRestoreText);l.on("keyup",d);l.on("change",d);d()},success:function(){var f=b.one(".flickr-follow-yes");var d=b.one(".flickr-follow-no");if(f&&d){f.on("click",e);d.on("click",e)}function e(k){var j=k.target.getAttribute("data-action");var i=b.shareThisV3Dialog.get_current_service();var g=[];g.push("action="+j);g.push("service_type_id=9");g.push("service_id="+i.service_id);g.push("magic_cookie="+b.config.flickr.magic_cookie);g=g.join("&");var h="/share.gne";if(j=="followFlickr"){b.one("#follow-flickr").set("innerHTML",'<p class="follow-working">'+b.transjax.get("share-this-v3-dialog","following_flickr_waiting")+"</p>")}else{b.one("#follow-flickr").remove();b.one(".follow-flickr-headline").remove()}b.io(h,{method:"POST",data:g,on:{complete:function(n,l,m){if(c(l.responseText)){b.one("#follow-flickr").set("innerHTML",'<p class="follow-error">'+b.transjax.get("share-this-v3-dialog","try_again_later")+"</p>")}else{if(j=="followFlickr"){b.one("#follow-flickr").set("innerHTML",'<p class="follow-success">'+b.transjax.get("share-this-v3-dialog","following_flickr_success")+"</p>")}}}}});k.preventDefault();return}function c(g){return(g&&g.match(/state-error/i))}}},on_submit_form:{share:function(){b.shareThisV3Dialog.service_helpers.maybeClearText({target:b.one("#tweet-text")})}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-wordpress",function(c){var b=c.shareThisV3Services;function a(){var e=c.one("#share-form-wordpress"),g=c.one("#wp-setup-api-endpoint"),d=c.one("#wp-setup-username"),f=false;if(d.get("value")!==""&&g.get("value")!==""){f=true}if(f){c.shareThisV3Dialog.service_helpers.enableForm(e)}else{c.shareThisV3Dialog.service_helpers.disableForm(e)}}if(!b){c.log("Y.shareThisV3Services null/undefined?")}else{b.add_service({name:"wordpress",id:7,use_setup_dialog:true,default_text:null,on_show_screen:{setup:function(){c.log("wordpress: setup screen");var e=c.shareThisV3Dialog.get_current_service(),f=c.one("#wp-setup-api-endpoint"),d=c.one("#wp-setup-username");if(f){f.on("focus",e.misc.maybe_highlight_endpoint);f.focus();f.on("keypress",a);f.on("keyup",a)}if(d){d.on("keypress",a);d.on("keyup",a)}a()},setup_choose_a_blog:function(){c.log("wordpress: choose_a_blog()")},share:function(){c.log("wordpress: share screen");var g=c.shareThisV3Dialog.service_helpers,e=c.shareThisV3Dialog.get_current_service(),d=c.one("#wordpress-text"),f=c.one("#wordpress-subject");c.global_dialog.set_loading(false);c.global_dialog.show();e.default_text=d.getAttribute("data-default-text");g.addDescriptionEvents(c.one("#share-this-v3-dialog .add-object-description"),d);d.on("focus",g.maybeClearText);d.on("blur",g.maybeRestoreText);if(f){f.focus()}},password:function(){c.log("wordpress: password screen");var e=c.shareThisV3Dialog.get_current_service(),d=c.one("#wp-setup-password");if(d){d.focus()}}},on_submit_form:{share:function(){c.shareThisV3Dialog.service_helpers.maybeClearText({target:c.one("#wordpress-text")})},setup_choose_a_blog:function(){c.global_dialog.hide();c.global_dialog.set_loading(true)}},on_auth_failed:function(){c.log("on_auth_failed");set_dialog_state("state-setup state-setup-error");c.global_dialog.reposition();c.log("setup screen shown - now what, complain?")},misc:{maybe_highlight_endpoint:function(g){var h=g.target,i=g.target.getAttribute("data-default-url"),d=g.target.get("value"),f=d.indexOf(i);if(f!==-1){c.shareThisV3Dialog.service_helpers.setSelectionRange(c.Node.getDOMNode(h),f,f+i.length)}}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-yahoo-pulse",function(c){var b=c.shareThisV3Services,d="#pulse-text",a;if(!b){c.log("Y.shareThisV3Services null/undefined?")}else{b.add_service({name:"yahoo",id:129,default_text:null,flickr_shorturl_length:null,share_signed_out:function(f){},on_show_screen:{share:function(){c.log("on_show_screen:share");var f=c.shareThisV3Dialog.get_current_service(),e=c.one(d);f.default_text=e.getAttribute("data-default-text");e.on("focus",c.shareThisV3Dialog.service_helpers.maybeClearText);e.on("blur",c.shareThisV3Dialog.service_helpers.maybeRestoreText)}},on_submit_form:{share:function(){c.shareThisV3Dialog.service_helpers.maybeClearText({target:c.one(d)});c.fire("shareDialog:servicesAuthComplete")}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-dialog",function(c){var O=null;var L=null;var S=null;var b=null;var z=null;var B=null;var C=[];var n="state-";var Q="share-this-v3-dialog";var d=(function(){var ac="#guestpass-box",ag="data-required",ad="data-auto-guestpass";function ai(){var an=c.one(ac);if(!an){return false}return(an.getAttribute(ag)==="true")}function ak(){var ap=c.one(ac),an=(ap?ap.all('input[type="checkbox"]'):null),ao=false;if(an){an.each(function(){if(this.get("checked")){ao=true}})}return ao}function U(){var an=c.one(ac);if(!an){return false}return(an.getAttribute(ad)==="true")}var aa={setup:function(){},share:function(){if(c.one(ac)){r()}},success:function(){c.use("flanal",function(an){an.flanal("flickr.sharing."+B.name+"_share_complete",B.name+"_share_complete")})}};function aj(){v();M()}function V(){if(typeof B.setup_only!=="undefined"&&B.setup_only){c.global_dialog.hide();c.global_dialog.set_loading(true);setTimeout(function(){window.location.href="/account/?tab=extend"},20);return true}else{return false}}function Z(ao){var an=ao.target,ap=an.get("value");if(ap===B.default_text){an.set("value","");an.removeClass("default-text");if(typeof updateWhileTyping!=="undefined"){updateWhileTyping()}}}function al(an){}function af(at){var ar=at,ao=ar.get("type");if(ao!=="password"){if(c.UA.ie){var aq=c.Node.getDOMNode(ar),ap=aq.cloneNode(true),an;ap.type="password";ap.value="";an=aq.parentNode.insertBefore(ap,aq);aq.parentNode.removeChild(aq);setTimeout(function(){try{an.focus()}catch(au){}},10)}else{ar.set("type","password");ar.set("value","")}}}function ae(ao,ap,aq){if(ao.setSelectionRange){ao.focus();ao.setSelectionRange(ap,aq)}else{if(ao.createTextRange){var an=ao.createTextRange();an.collapse(true);an.moveEnd("character",aq);an.moveStart("character",ap);an.select()}}}function Y(an){var ao=(an?an:c.one("#share-this-v3-dialog textarea.share-object-description"));if(ao){return(ao.get("value"))}}function am(an,ap){Z({target:an});var aq=Y(),ao=an.get("value");if(aq){an.set("value",(ao?ao+"\n\n":"")+aq)}ap.preventDefault();return false}function ah(ao,an){if(ao){ao.on("click",function(ap){c.shareThisV3Dialog.service_helpers.addObjectDescription(an,ap);ap.target.ancestor(".add-description").addClass("description-added")})}}function W(){var ao=c.one("#share-this-v3-dialog"),ap=ao.one(".more-options"),an=ao.one(".more-options-toggler");if(ap&&an&&an.one("a")){an.one("a").on("click",function(aq){aq.preventDefault();ap.toggleClass("more-options-open");an.toggleClass("more-options-toggler-open")})}}function T(ao){var an=ao.all('input[type="submit"]');an.each(function(){this.replaceClass("Butt","DisabledButt");this.setAttribute("disabled","disabled")})}function X(ao){var an=ao.all('input[type="submit"]');an.each(function(){this.replaceClass("DisabledButt","Butt");this.removeAttribute("disabled")})}function ab(){c.global_dialog.remove_existing_dialog();c.global_dialog.set_loading(false);c.global_dialog.create_alert_dialog("<b>"+c.transjax.get("share-this-v3-dialog","try_again_later")+"</b>",function(){c.global_dialog.hide()})}return{assign_events:aj,addDescriptionEvents:ah,addObjectDescription:am,addMoreOptionsEvents:W,disableForm:T,enableForm:X,genericError:ab,is_guestpass_automatic:U,is_guestpass_chosen:ak,is_guestpass_required:ai,on_show_screen:aa,maybeClearText:Z,maybeRestoreText:al,setupOnly:V,setPasswordField:af,setSelectionRange:ae}}());var k={};function q(U){var V,T=null;U=parseInt(U,10);for(V in k){if(k.hasOwnProperty(V)&&k[V].id===U){T=k[V].name;break}}return T}function P(T){var U,W=[],V={object_id:y(),owner_nsid:a(),object_type:w()};if(!T){return V}for(U in V){if(V.hasOwnProperty(U)){W.push(U+"="+V[U])}}return W}function y(){if(c.config&&c.config.flickr&&c.config.flickr.sharing&&c.config.flickr.sharing.object){return c.config.flickr.sharing.object.id}else{return null}}function a(){if(c.config&&c.config.flickr&&c.config.flickr.sharing&&c.config.flickr.sharing.object){return c.config.flickr.sharing.object.owner_nsid}else{return null}}function w(){if(c.config&&c.config.flickr&&c.config.flickr.sharing&&c.config.flickr.sharing.object){return c.config.flickr.sharing.object.type}else{return null}}function D(){var U=c.one("#share-this-v3-dialog"),T=null;if(U){T=U.getAttribute("data-state")}return T}function l(V){var U="#share-this-dialog-state",T;if(c.one(U)){c.one(U).setAttribute("class",V)}if(V&&V.length>n.length){V=V.substr(n.length);if(V!=="working"){m()}T=c.one("#share-this-v3-dialog .auto-focus");if(T){T.focus()}if(d.on_show_screen&&d.on_show_screen[V]){d.on_show_screen[V]()}if(B&&B.on_show_screen&&B.on_show_screen[V]){B.on_show_screen[V]()}}}function A(){l("state-setup")}function H(){function U(W){return(parseInt(W.get("offsetHeight"),10)-20)}var T={left:c.one("#global-dialog-container .left-item"),right:c.one("#global-dialog-container .right-item")},V={};if(T.left&&T.right){V={left:U(T.left),right:U(T.right)};if(V.left>V.right){T.right.setStyle("minHeight",V.left+"px")}else{T.left.setStyle("minHeight",V.right+"px")}}c.global_dialog.reposition()}function i(T){j()}function p(T){C.push(T)}function m(){for(var T=C.length;T--;){C[T].detach()}C=[]}function r(){p(c.all('#guestpass-box input[type="checkbox"]').on("click",i))}function M(){p(c.all("#global-dialog-container form.share-form").on("submit",o))}function v(){var T="#global-dialog-container a, #global-dialog-container input",V=c.one(".fb-needs-reconnect");function U(X){var W=X.target;if(W&&(W.hasClass("close-x")||W.hasClass("CancelButt")||W.hasClass("dismissDialog"))){c.global_dialog.hide();X.preventDefault();if(c.PageContext){c.PageContext.unset(Q)}return false}}c.all(T).on("click",U);if(V){V.on("click",function(W){W.preventDefault();c.global_dialog.hide();if(c.PageContext){c.PageContext.unset(Q)}c.shareThisV3Dialog.share_by_service(B.id,B.service_type_id,true,false,null,W)},this)}}function I(){B.needs_setup=true;if(B.on_auth_failed){B.on_auth_failed()}}function K(W,X,T){var V;if(B&&B.needs_setup){if(X.responseText){c.one("#share-this-v3-dialog").get("parentNode").set("innerHTML",X.responseText);V=D();if(V&&V.match(/share/i)){c.fire("shareDialog:servicesAuthComplete")}l(V)}else{var U=d.setupOnly();if(!U){I()}}}else{if(G(X.responseText)){if(c.one("#share-this-v3-dialog")){c.one("#share-this-v3-dialog").get("parentNode").set("innerHTML",X.responseText);V=D();l(V)}else{d.genericError()}}else{d.genericError()}}d.assign_events()}function E(){var T=D();if(T){l(T)}}function o(V){var W=V.target,U,T;if(W.hasClass("scrumjax-exclude")){c.global_dialog.hide();c.global_dialog.set_loading(true);return true}if(B){T=D();if(T){U=T.substr(n.length);if(B.on_submit_form&&B.on_submit_form[U]){B.on_submit_form[U](V)}}}c.use("io-form",function(){var X={method:"POST",form:{id:W.getAttribute("id"),useDisabled:false},on:{success:K,failure:K,timeout:K}};if(B&&B.setup_only){l("state-working setup-only")}else{l("state-working")}var Y=W.getAttribute("action");if(!Y){Y=W.getAttribute("data-ie-action")}if(c.one("#"+W.getAttribute("id"))){c.io(Y,X)}});V.preventDefault();return false}function G(T){return(T&&T.match(/share\-this\-v3/i))}function e(W,U,V,T){var Y={success:function(ad,ab,ac){var Z=ab.responseText,aa;if(G(Z)){c.global_dialog.remove_existing_dialog();c.global_dialog.create_dialog(Z);aa=D();c.global_dialog.show({modal:true,width:(!c.UA.ie||c.config.is_zeus?422:440)});if(V&&V.on_complete){V.on_complete()}else{l(aa)}c.global_dialog.reposition();c.global_dialog.set_loading(false);c.global_dialog.set_modal(true);d.assign_events()}else{if(B&&B.setup_only){d.setupOnly()}else{d.genericError()}}},failure:function(ab,Z,aa){if(Z.statusText==="timeout"){if(B&&B.needs_auth&&B.on_auth_failed){B.on_auth_failed()}}else{if(B&&B.needs_auth&&B.on_auth_failed){B.on_auth_failed()}else{c.global_dialog.hide();d.genericError()}}}};var X=(typeof T!=="undefined"?T:Y);c.global_dialog.set_loading(true);c.io(W,{method:"POST",data:U,on:X,"arguments":U})}function x(U){var W=(U||null),V="/share.gne",T=[];T.push("action=delete");if(U.service_id){T.push("service_id="+U.service_id)}if(U.service_type_id){T.push("service_type_id="+U.service_type_id)}T.push("cachebust="+(new Date()).getTime());T=T.join("&");W={on_complete:function(){var Y=c.one("#share-confirm-delete");if(Y){try{Y.focus()}catch(X){}}p(c.one("#global-dialog-container form.scrumjax-exclude").on("submit",o))}};e(V,T,W)}function h(U){var W=(U||null),V="/share.gne",T=[];T.push("action=retrieve_fragments");if(B.needs_setup){T.push("fragments[]=dialog-setup")}else{T.push("fragments[]=dialog-share")}if(L){T.push("service_name="+L)}if(S){T.push("object_id="+S)}if(b){T.push("object_type="+b)}if(z){T.push("owner_nsid="+z)}T.push("cachebust="+(new Date()).getTime());if(B){if(B.setup_only){T.push("setup_only=1")}if(B.service_id){T.push("service_id="+B.service_id)}if(B.service_type_id){T.push("service_type_id="+B.service_type_id)}}T=T.join("&");e(V,T,W)}function j(U){var W=(U||null),V="/share.gne",T=[];T.push("action=retrieve_fragments");T.push("fragments[]=dialog-share-thumbnails");if(L){T.push("service_name="+L)}if(S){T.push("object_id="+S)}if(b){T.push("object_type="+b)}if(z){T.push("owner_nsid="+z)}if(B){if(B.service_id){T.push("service_id="+B.service_id)}if(B.service_type_id){T.push("service_type_id="+B.service_type_id)}}c.one("#global_dialog").all("input.gp-type:checked").each(function(Y){T.push(Y.getAttribute("name")+"=1")});T=T.join("&");W={on_complete:function(){}};var X={success:function(ab,Z,aa){var Y=Z.responseText;c.one("#share-this-thumbnail").get("parentNode").set("innerHTML",Y)}};c.one("#share-this-thumbnail-loading").setStyle("display","block");e(V,T,W,X)}function g(V,Z,U,X,W,T){if(c.PageContext){c.PageContext.set(Q)}S=y();b=w();z=a();L=q(Z);if(!k[L]){return false}else{B=k[L]}var Y=T&&typeof c.config.flickr.user.admin_user!=="undefined"?T.altKey:false;if(!W&&!Y&&c.config&&c.config.flickr&&c.config.flickr.user&&c.config.flickr.user.nsid){}else{if(!W&&!Y&&typeof global_nsid!=="undefined"&&global_nsid){}else{if(B.share_signed_out){B.share_signed_out(T);T.preventDefault();return false}}}c.fire("flickr-menus:hide");B.needs_setup=U;B.service_id=V;B.service_type_id=Z;B.setup_only=X;if(U){if(B.use_popup&&B.setup_url){s(B.setup_url,B.popup_params,function(){if(B.on_window_closed){B.on_window_closed();c.fire("shareDialog:servicesAuthComplete")}})}else{if(B.use_setup_dialog){h({on_complete:function(){if(B.needs_setup){A()}}})}else{h({on_complete:function(){if(B.needs_setup){A()}}})}}return false}else{h()}return false}function u(){return B}function N(){c.global_dialog.set_loading(true)}function t(T){if(O&&O.closed){T()}else{setTimeout(function(){t(T)},1000)}}function s(V,T,W){var X,U=[];for(X in T){if(T.hasOwnProperty(X)){U.push(X+"="+T[X])}}U.push("resizable=1");U.push("scrollbars=1");try{O=window.open(V,"newWindow",U.join(","));if(O.focus){O.focus()}}catch(Y){return true}if(W){N();t(W)}return false}function f(){var U={},T;U.service_type_id=c.one("#form_service_type_id").get("value");U.object_type=c.one("#form_object_type").get("value");U.object_id=c.one("#form_object_id").get("value");T=c.one("#form_owner_nsid");if(T){U.owner_nsid=T.get("value")}return U}function R(U){var W=[];for(var V in U){if(U.hasOwnProperty(V)){W.push(V+"="+encodeURIComponent(U[V]))}}var T={method:"POST",data:W.join("&"),on:{complete:function(Z,X){var Y=X.responseText;if(G(Y)){c.global_dialog.create_dialog(Y).show({modal:true,width:(!c.UA.ie||c.config.is_zeus?422:440)});v()}else{c.shareThisV3Dialog.service_helpers.genericError()}}}};c.io("/share.gne",T)}function J(){if(c.shareThisV3Services){k=c.shareThisV3Services.get_services()}}J();c.shareThisV3Dialog={assign_dialog_dismiss_events:v,confirm_delete:x,do_share_action:R,fetch_sharing_fragment:h,get_current_service:u,get_form_params:f,init:J,refresh_dialog_state:E,services:k,service_helpers:d,get_share_this_data:P,share_by_service:g,set_dialog_state:l,show_setup_state:A,webCirca1999:s}},"0.0.1",{requires:F.config.modules["share-this-v3-dialog"].requires||[],optional:F.config.modules["share-this-v3-dialog"].optional||[]});YUI.add("share-this-v3-triggers",function(c){function b(d){d.on("click",a)}function a(j){var f,m,k,i,o,l,d,n,g,h;f=j.target.ancestor("a.share-dialog-action",true);if(!f&&j.target.hasClass("Butt")){f=j.target.one("a.share-dialog-action")}if(!f){return}if(f.hasClass("share-disabled")){j.preventDefault();return}k=f.getAttribute("data-service-id");i=f.getAttribute("data-service-type-id");if(!i){j.preventDefault();return}l=f.getAttribute("data-setup-only");d=(f.getAttribute("data-service-needs-setup")==="true");n=(f.getAttribute("data-service-always-use-popup")==="true");if(!d&&j.shiftKey){c.log("Allowing set-up override");d=true}if(!l){m=c.shareThisV3Services.get_service(parseInt(i,10));o=m&&m.name&&m.name.replace(/[^a-zA-Z0-9_\-]/g,"_");if(o){if(c.config.flickr.user.nsid){if(d){h=o+"_button_needs_setup"}else{h=o+"_button_already_setup"}}else{h=o+"_button_signed_out"}g="flickr.sharing_triggers."+h;c.flanal(g,h)}}c.shareThisV3Dialog.share_by_service(k,i,d,l,n,j);j.preventDefault();return false}c.shareThisV3Triggers={listen:b,handleClick:a}},"0.0.1",{requires:F.config.modules["share-this-v3-triggers"].requires||[],optional:F.config.modules["share-this-v3-triggers"].optional||[]});YUI.add("share-this-v3-menu",function(c){var T,P,I,M,e,w="share-options-open",b="share-options-deferred",t="share-options-placeholder",B="share-menu",K={},m=false,E=c.config.flickr.page_type==="photo",J=c.config.flickr.page_type==="faves",p=c.config.flickr.flags.enable_2013_photo_page_extras,x=c.config.flickr.page_type==="sihp",g=c.config.flickr.page_type==="photostream",G=c.config.flickr.page_type==="set",s=c.config.flickr.page_type==="faves",k=c.config.flickr.page_type==="group_pool",D=p&&(E||J),C=D||x||(p&&(g||G||s)),v;function N(X){var Y,V,Z,W=X||{};V=W.localPlacement||"#photo-actions #stats_ul";function U(){P=c.menus.add({id:"share-menu-v3",popover:Z,context:B,button_node:W.button_node||q(),constrain_node:D?c.one(document.body):null,scroll:p&&(!(g||G||s||k)||c.config.flickr.flags.enable_justified_view_inline_sharing)?W.scroll:null,onHide:function(){if(W&&W.onHide){W.onHide()}}})}T=c.one("#share-menu-v3");if(!T){c.log("share menu v3:: WARN: Could not find menuNode","error","share-this-v3-menu")}e=c.one("#post-upload-actions");if(e){c.shareThisV3Triggers.listen(e)}M=c.one("#share-buttons, "+(D&&E?"#stats_ul":"#button-bar"));if(M){c.shareThisV3Triggers.listen(M);if(!c.config.flickr.is_touch_device){Y=M.on("mouseover",function(aa){if(q().contains(aa.target)){Y.detach();u()}})}}if(T){T.on("click",n);T.on("mousedown",o);T.on("mouseup",l);if(!c.config.flickr.is_touch_device){T.on("mouseover",c.betterThrottle(function(ab){var aa=ab.target.ancestor("li."+b,true);if(aa){u(aa)}},100))}i();Z=new c.Popover({srcNode:"#share-menu-v3",visible:false,width:"400px",accordian:true,arrowPosition:W.arrowPosition||"tr",isRefresh:W.overrideRefresh||D,refreshBottom:W.bottom||"37px",refreshRight:W.right||"66px",showSquare:C,extraCSS:C?"square-menu-css":""});Z.on("visibleChange",function(aa){if(aa.newVal){a();u()}});Z.render((D&&!W.overrideRefresh)?c.one(V):undefined);if(c.one("#post-upload-share-more-button")){I=c.menus.add({id:"share-menu-v3",popover:Z,context:B,button_node:c.one("#post-upload-share-more-button")});c.on("postUploadSharing:close",U)}else{U()}}c.on("shareDialog:servicesAuthComplete",function(){if(P){P.hide()}y();window.setTimeout(function(){A((p?["menu-services"]:["buttons","menu-services"]),{reload:true})},1000)});if(c.config.flickr.sharing.shareability_is_unknown){A((p?["menu-full"]:["buttons","menu-full"]),{menuCallback:W.afterInit})}if(F.actionQueue&&c.Lang.isObject(F.actionQueue)){F.actionQueue["share-this-v3-more-button"]={display_share:function(){if(P){P.show()}}};F.actionQueue.module_loaded("share-this-v3-more-button")}c.fire("shareMenu:initialized");m=true}function o(U){if(U.target.test("#share-options-grablink-input")||U.target.test(".embed-markup")){U.target.select()}}function l(U){if(U.target.test("#share-options-grablink-input")||U.target.test(".embed-markup")){U.preventDefault()}}function n(U){if(U.target.test("#share-options-grablink-input")||U.target.test(".embed-markup")){U.target.select();U.preventDefault()}else{if(U.target.ancestor("li.share-options div.share-options-header",true)){U.preventDefault();j(U.target.ancestor("li"))}else{if(U.target.ancestor(".share-more-ways",true)){U.preventDefault();T.one(".share-services-small").toggleClass("share-hidden")}else{if(U.target.ancestor("ul.share-options-list li, ul.share-services li, ul.share-services-small li",true)){c.shareThisV3Triggers.handleClick(U)}else{if(U.target.ancestor("form#grab-link input",true)){L(U)}else{if(U.target.ancestor("form#sharing-get-html-form input",true)){z(U)}}}}}}}function a(U){U=U||T.one("."+w);if(U&&U.getAttribute("data-panel-name")==="services"){d(U)}}function u(U){U=U||T.one("."+w);if(U&&U.hasClass(b)){if(U.get("id")==="share-options-grablink"){A(["menu-grab-the-link"])}else{if(U.get("id")==="share-options-services"){A(["menu-services"])}}U.removeClass(b)}}function j(V){var Z,U,ae,ab,ag,W,af,ad,Y,ac,X,ah,aa;if(!V||V.hasClass(w)){return false}ae=T.one("."+w);a(ae);u(V);U=V.one(".share-options-header");Z=V.one(".share-options-inner");Z.setStyle("display","block");W=Z.get("offsetHeight")+parseInt(Z.getComputedStyle("marginTop"),10)+parseInt(Z.getComputedStyle("marginBottom"),10)+U.get("offsetHeight")+parseInt(U.getComputedStyle("marginTop"),10)+parseInt(U.getComputedStyle("marginBottom"),10);ad=new c.Anim({node:V,to:{height:W},duration:0.42,easing:c.Easing.easeBoth});ad.on("end",function(){V.setStyle("height","");V.addClass(w)});if(!c.UA.ie||c.UA.ie>=8){Y=new c.Anim({node:U,from:{backgroundColor:"#0063DC",color:"#ffffff"},to:{backgroundColor:"#ffffff",color:"#000000"},duration:0.42,easing:c.Easing.easeBoth});Y.on("end",function(){U.setStyle("backgroundColor","");U.setStyle("color","")})}if(ae){ag=ae.one(".share-options-header");ab=ae.one(".share-options-inner");af=ag.get("offsetHeight")+parseInt(ag.getComputedStyle("marginTop"),10)+parseInt(ag.getComputedStyle("marginBottom"),10);ac=new c.Anim({node:ae,to:{height:af},duration:0.25,easing:c.Easing.easeBoth});ac.on("end",function(){ae.setStyle("height","");ae.removeClass(w);ab.setStyle("display","none")});if(!c.UA.ie||c.UA.ie>=8){X=new c.Anim({node:ag,from:{backgroundColor:"#ffffff",color:"#000000"},to:{backgroundColor:"#F6F6F6",color:"#0063dc"},duration:0.25,easing:c.Easing.easeBoth});X.on("end",function(){ag.setStyle("backgroundColor","");ag.setStyle("color","")})}ac.run();if(X){X.run()}}ah=V.getAttribute("data-panel-name");ad.run();if(Y){Y.run()}a(V);aa={services:1,link:2,embed:3,party:0};if(ah&&aa[ah]){if(j.pending){window.clearTimeout(j.pending);j.pending=undefined}j.pending=window.setTimeout(function(){c.flickrAPI.callMethod("flickr.prefs.setPrefs",{share_this_panel:aa[ah]})},2000)}}function q(){return M&&M.one(".share-dropdown-arrow")}function Q(){var U,W,V;U=T.one("#share-options-grablink-input");W=T.one("#short-url input");if(W){V=W.get("checked")?W.getAttribute("data-url-short"):W.getAttribute("data-url-long")}if(V){U.set("value",V);U.select()}}function L(U){if(U.target.get("id")==="gp-short-url"){Q()}else{if(U.target.hasClass("gp-type")){if(T.one("form#grab-link input.gp-type:checked")){T.one("#gp-add-button").replaceClass("DisabledButt","Butt")}else{T.one("#gp-add-button").replaceClass("Butt","DisabledButt")}}else{if(U.target.get("id")==="gp-add-button"){U.preventDefault();if(!U.target.hasClass("DisabledButt")){window.setTimeout(function(){A(["menu-grab-the-link"],{reload:true,guestpass:true})},10)}}}}}function z(V){var U=V.target.get("id");if(U==="code-type-bbcode"||U==="code-type-html"||U==="code-type-playr"){h()}}function h(){var V,Y,X,U,W,Z;V={playr:{Thumbnail:"share-options-embed-textarea-t-playr",Square:"share-options-embed-textarea-sq-playr","Large Square":"share-options-embed-textarea-q-playr",Small:"share-options-embed-textarea-s-playr","Small 320":"share-options-embed-textarea-n-playr",Medium:"share-options-embed-textarea-m-playr","Medium 640":"share-options-embed-textarea-z-playr","Medium 800":"share-options-embed-textarea-c-playr",Large:"share-options-embed-textarea-l-playr","Large 1600":"share-options-embed-textarea-h-playr","Large 2048":"share-options-embed-textarea-k-playr",Original:"share-options-embed-textarea-o-playr"},html:{Thumbnail:"share-options-embed-textarea-t",Square:"share-options-embed-textarea-sq","Large Square":"share-options-embed-textarea-q",Small:"share-options-embed-textarea-s","Small 320":"share-options-embed-textarea-n",Medium:"share-options-embed-textarea-m","Medium 640":"share-options-embed-textarea-z","Medium 800":"share-options-embed-textarea-c",Large:"share-options-embed-textarea-l","Large 1600":"share-options-embed-textarea-h","Large 2048":"share-options-embed-textarea-k",Original:"share-options-embed-textarea-o"},bbcode:{Thumbnail:"share-options-embed-textarea-t-bbcode",Square:"share-options-embed-textarea-sq-bbcode","Large Square":"share-options-embed-textarea-q-bbcode",Small:"share-options-embed-textarea-s-bbcode","Small 320":"share-options-embed-textarea-n-bbcode",Medium:"share-options-embed-textarea-m-bbcode","Medium 640":"share-options-embed-textarea-z-bbcode","Medium 800":"share-options-embed-textarea-c-bbcode",Large:"share-options-embed-textarea-l-bbcode","Large 1600":"share-options-embed-textarea-h-bbcode","Large 2048":"share-options-embed-textarea-k-bbcode",Original:"share-options-embed-textarea-o-bbcode"}};Y={html:0,bbcode:1};if(c.config.flickr.flags.enable_playr){Y={html:2,bbcode:1,playr:0}}X={Square:1,Thumbnail:2,Small:3,Medium:4,"Medium 640":5,Large:6,Original:7,"Large Square":8,"Small 320":9,"Medium 800":10,"Large 1600":11,"Large 2048":12};U=c.one("#sharing_size").get("value");if(c.one("#code-type-bbcode").get("checked")){W="bbcode"}else{if(c.one("#code-type-playr")&&c.one("#code-type-playr").get("checked")){W="playr"}else{W="html"}}Z=V[W][U];c.all(".embed-markup").each(function(aa){aa.setStyle("display","none")});c.one("#"+Z).setStyle("display","block");if(h.pending){window.clearTimeout(h.pending);h.pending=undefined}h.pending=window.setTimeout(function(){c.flickrAPI.callMethod("flickr.prefs.setPrefs",{photo_embed_type:Y[W],photo_embed_size_new:X[U]})},2000)}function i(){if(!K.embed_size_change_handle&&c.one("#sharing_size")){K.embed_size_change_handle=c.one("#sharing_size").on("change",function(U){h()})}}function f(){c.Object.each(K,function(V,U){if(V&&V.detach){V.detach();K[U]=undefined}})}function y(){var U;if(M){U=M.all(".share-this-v3");if(U&&U.size()){U.each(function(X){var V=X.one(".Butt, .DisabledButt"),W;if(V){V.removeClass("Butt").addClass("DisabledButt share-disabled");W=V.one("a");if(W){W.removeAttribute("data-service-type-id");W.removeAttribute("data-service-id");W.removeAttribute("data-service-needs-setup")}}})}}}function O(V,X,ab){var ac="...",Y=ab.get("innerHTML"),Z=Y.match(/\.\.\./),U=Y.length-(Z?3:0),aa=8,W=V.get("offsetWidth");if(W>X&&U>aa){ab.set("innerHTML",Y.substr(0,Y.length-(Z?4:1))+ac);O.apply(this,arguments)}V.setAttribute("data-truncated",1)}function d(U){if(U&&U.one("li")){var V=U.one("li").get("offsetWidth"),W=U.all(".service-username");if(W){W.each(function(){if(!this.getAttribute("data-truncated")){O(this,V,this.one(".service-truncated"))}})}}}function S(){return c.JSON.stringify(c.config.flickr.sharing.object)}function R(W,V){var U=V?["menu-full"]:["buttons","menu-full"];A(U,{menuCallback:W})}function H(){var U;if(M){U=M.all(".share-this-v3");if(U&&U.size()){U.remove()}}}function A(aa,X){var W,ab,U,Z=[],V="/share.gne",ac=[],Y;if(!aa){return false}if(c.Lang.isString(aa)){aa=[aa]}if(!c.Lang.isArray(aa)){return false}X=X||{};W=S();U={buttons:{on:{start:function(){if(!M){return false}if(p){return false}y();return true},success:function(ad){var ae;if(M){ae=c.Node.create(ad);if(ae){M.all(".share-this-v3").remove();if(c.config.flickr.flags.enable_2013_photo_page&&(E||J)){M.all(".divider").insert(ae,"before")}else{M.append(ae)}P.set("button_node",q());if(I){I.set("button_node",c.one("#post-upload-share-more-button"))}}}}}},"menu-grab-the-link":{on:{start:function(){if(X.reload){if(!ab["menu-grab-the-link"].placeholder_node){ab["menu-grab-the-link"].placeholder_node=T.one("#share-options-grablink ."+t);if(!ab["menu-grab-the-link"].placeholder_node){ab["menu-grab-the-link"].placeholder_node=T.one("#share-options-grablink .share-options-inner")}}if(X.guestpass){ac.push("guestpass=1");ab["menu-grab-the-link"].placeholder_node.all("form#grab-link input.gp-type:checked").each(function(ad){ac.push(ad.getAttribute("name")+"=1")})}ab["menu-grab-the-link"].loaded=false;ab["menu-grab-the-link"].placeholder_node.addClass(t);ab["menu-grab-the-link"].placeholder_node.set("innerHTML","")}if(ab["menu-grab-the-link"].loaded){return false}if(T.one("form#grab-link")){ab["menu-grab-the-link"].loaded=true;return false}if(!ab["menu-grab-the-link"].placeholder_node){ab["menu-grab-the-link"].placeholder_node=T.one("#share-options-grablink ."+t);if(!ab["menu-grab-the-link"].placeholder_node){c.log("Missing placeholder node","error","share-this-v3-menu");return false}}ab["menu-grab-the-link"].placeholder_node.set("innerHTML","").addClass(t);return true},success:function(ad){ab["menu-grab-the-link"].loaded=true;ab["menu-grab-the-link"].placeholder_node.set("innerHTML",ad);if(X.guestpass){if(c.config.flickr.page_type==="photo"&&c.photo&&c.photo.getCurrentPhoto){c.use("photo-data",function(af){var ae=af.photo.getCurrentPhoto();if(ae){ae.increment("guestpass_count")}})}}},failure:function(){ab["menu-grab-the-link"].placeholder_node.set("innerHTML",c.transjax.get("share-menu","grab_the_link_fragment_error"))},complete:function(){ab["menu-grab-the-link"].placeholder_node.removeClass(t)}}},"menu-services":{on:{start:function(){if(X.reload){if(!ab["menu-services"].placeholder_node){ab["menu-services"].placeholder_node=T.one("#share-options-services ."+t);if(!ab["menu-services"].placeholder_node){ab["menu-services"].placeholder_node=T.one("#share-options-services .share-options-inner")}}ab["menu-services"].loaded=false;ab["menu-services"].placeholder_node.addClass(t);ab["menu-services"].placeholder_node.set("innerHTML","")}if(ab["menu-services"].loaded){return false}if(T.one("ul.share-services")){ab["menu-services"].loaded=true;return false}if(!ab["menu-services"].placeholder_node){ab["menu-services"].placeholder_node=T.one("#share-options-services ."+t);if(!ab["menu-services"].placeholder_node){c.log("Missing placeholder node","error","share-this-v3-menu");return false}}return true},success:function(ad){ab["menu-services"].loaded=true;ab["menu-services"].placeholder_node.removeClass(t);ab["menu-services"].placeholder_node.set("innerHTML",ad)},failure:function(af,ae,ad){ab["menu-services"].placeholder_node.set("innerHTML",c.transjax.get("share-menu","services_fragment_error"))},complete:function(){ab["menu-services"].placeholder_node.removeClass(t)}}},"menu-full":{on:{start:function(){f();return true},success:function(ad){if(T){T.set("innerHTML",ad)}i();if(X.menuCallback){X.menuCallback()}}}}};if(!A.memo){A.memo={};c.Object.each(U,function(ae,ad){A.memo[ad]={fetching:{}}})}ab=A.memo;c.Array.each(aa,function(af,ad){var ae;if(ab[af].fetching[W]){return false}ae=U[af].on.start.apply(window);if(ae){Z.push(af)}});if(Z.length===0){return false}if(c.config.flickr.sharing.object.id){ac.push("object_id="+c.config.flickr.sharing.object.id)}if(c.config.flickr.sharing.object.type){ac.push("object_type="+c.config.flickr.sharing.object.type)}if(c.config.flickr.sharing.object.owner_nsid){ac.push("owner_nsid="+c.config.flickr.sharing.object.owner_nsid);ac.push("object_owner_nsid="+c.config.flickr.sharing.object.owner_nsid)}ac.push("cachebust="+(new Date()).getTime());ac.push("action=retrieve_fragments");c.Array.each(Z,function(ad){ac.push("fragments[]="+ad)});if(F.config.flickr.page_type==="photo"){ac.push("is_photo_page=true")}ac=ac.join("&");V=V+"?"+ac;Y={on:{success:function(af,ae){var ad=ae.responseText.split("<!-- Fragment -->");c.Array.each(Z,function(ah,ag){if(W===S()){if(c.Lang.isFunction(U[ah].on.success)){U[ah].on.success.apply(window,[ad[ag]])}if(c.Lang.isFunction(U[ah].on.complete)){U[ah].on.complete.apply(window,[])}}delete ab[ah].fetching[W]})},failure:function(af,ae){var ad=arguments;c.Array.each(Z,function(ag){if(W===S()){if(c.Lang.isFunction(U[ag].on.failure)){U[ag].on.failure.apply(window,ad)}if(c.Lang.isFunction(U[ag].on.complete)){U[ag].on.complete.apply(window,[])}}delete ab[ag].fetching[W]})}}};c.Array.each(Z,function(ad){ab[ad].fetching[W]=true});c.io(V,Y)}function r(){if(P){P.hide()}}c.shareThisV3Menu={init:N,show:function(){P.show()},hide:r,openPanel:j,disableButtons:y,refresh:R,clear:H,getMenu:function(){return P},isInitialized:function(){return m}}},"0.0.1",{requires:F.config.modules["share-this-v3-menu"].requires||[],optional:F.config.modules["share-this-v3-menu"].optional||[]});(function(){var a="refresh-sihp-comment";YUI.add(a,function(b){var p,e;var n={};var c=function(q){o(q)};b.config[a]=b.config[a]||{open_cards:{}};function o(r){var q,s;if(!b.Lang.isObject(r)){console.warn("["+a+"]","No config");return}q=r.container;if(b.Lang.isString(q)){q=b.one(q)}if(!b.Lang.isObject(q)||!q.getDOMNode){console.warn("["+a+"]","No container node");return}p=r;q.delegate("click",h,r.commentIconSelector);q.delegate("click",g,r.commentReplySelector||".comment-reply");m(q);e="refresh-sihp-comment:dismiss-dialog";b.on(e,f)}function h(w){if(w.preventDefault){w.preventDefault()}if(b.shareThisV3Menu.isInitialized()){b.shareThisV3Menu.hide()}var y=w.target.ancestor(p.photoContainerSelector),A=p.commentContainerSelector?y.ancestor(p.commentContainerSelector):y,B=p.photoNodeSelector?y.one(p.photoNodeSelector):y,x=w.target.ancestor(p.commentButtonNodeSelector,true),s=B.getAttribute("data-photo-id"),u=b.one(p.container).getComputedStyle("width"),z=B.get("offsetHeight"),v=(z+15)+"px",q=p.arrowOffset||39;if(w.target.ancestor(".leftPortrait")){q+=267}if(b.one(".comments-popover-"+s)){f();return}else{if(b.one(".comments-popover")){f()}}if(b.all(".comments-popover")){b.all(".comments-popover").remove()}if(b.all(p.commentIconSelector)){b.all(p.commentIconSelector).removeClass("active")}totalComments=parseInt(B.getAttribute("data-comments-total-count"),10);if(x.one(".li_icon")){x.one(".li_icon").remove()}else{if(p.onLoading){p.onLoading(x)}}x.append('<span class="html5-balls"><span class="blueball"></span><span class="pinkball"></span></span>');var r="magic_cookie="+b.config.flickr.magic_cookie+"&photo="+s+"&offset="+(totalComments-4)+"&limit=4&show-chrome=true&view-more-count=20&truncate-comment-body=120&hide-meta=true";var t={method:"post",data:r,on:{success:function(C,D,K){b.config[a].open_cards[parseInt(s,10)]=true;var N,J;A.append('<div id="comments" class="comments-popover comments-popover-'+s+'"><div class="arrow"></div><div class="comments-inner">'+D.responseText+"</div></div>");if(p.edgeDetection){if(x.getX()<570){A.one("#comments").setStyle("right","");A.one("#comments").setStyle("left","10px");var L=A.getComputedStyle("width");L=L.replace("px","");L=parseInt(L,10);q=L-75+10}if(x.getY()<570){var H=A.getComputedStyle("height");H=H.replace("px","");H=parseInt(H,10);A.one("#comments").setStyle("top",(H-3)+"px");A.one("#comments").setStyle("bottom","inherit");var M=A.one(".arrow");var E=M.getStyle("bottom");E=E.replace("px","");E=parseInt(E,10);M.setStyle("top",E);M.setStyle("bottom","inherit");M.setStyle("borderBottomColor",M.getStyle("borderTopColor"));M.setStyle("borderTopColor","transparent")}}else{if(y.hasClass("topRightLandscapeContainer")){var H=A.getComputedStyle("height");if(H){H=parseInt(H.replace("px",""),10);A.one("#comments").setStyle("bottom",((H/2)+37)+"px")}}else{if(y.hasClass("leftPortraitContainer")){A.one("#comments").setStyle("right","");A.one("#comments").setStyle("left","10px");var L=A.getComputedStyle("width");L=L.replace("px","");L=parseInt((L/2)+"px",10);q=L-75}}}x.one(".html5-balls").remove();x.addClass("active");if(p.onSuccess){p.onSuccess(y,x,totalComments)}else{x.append('<span class="li_icon"></span>')}N=A.one(".comment-button-post");if(N){N.on("click",function(O){j(O,s)})}if(A&&A.one("form #message")){A.one("form #message").on("keyup",function(O){n[s]=O.target.get("value")});if(n[s]){A.one("form #message").set("value",n[s])}}if(x.hasClass("counter1")){q+=5}else{if(x.hasClass("counter2")){q+=9}else{if(x.hasClass("counter3")){q+=13}}}J=A.one(".arrow");if(J){if((p.edgeDetection&&x.getX()<570)||y.hasClass("leftPortraitContainer")){J.setStyle("left",q+"px")}else{J.setStyle("right",q+"px")}}if(b.one("#load-more-next-comments")){b.one("#load-more-next-comments").hide()}var G=window.innerWidth+200;y.append("<div class='popover-shim' style='position: absolute; top: 0; left: -500px; height: 1000px; width: "+G+"px; z-index: 1;'></div>");if(b.one(".popover-shim")){b.one(".popover-shim").on("click",f)}b.keyboardShortcutManager.register({keystring:"27",handler:f,context:"*"});try{if(p.edgeDetection&&x.getY()<570){A.one(".comment-content textarea").vis.animScrollIntoView({bottom:true,top:false,onfinish:function(){A.one(".comment-content textarea").focus()}},100,true)}else{A.one(".comment-content textarea").focus()}}catch(I){}},failure:function(E,D,C){x.one(".html5-balls").remove();if(p.onSuccess){p.onSuccess(y,x,totalComments)}else{x.append('<span class="li_icon"></span>')}i(b.transjax.get("photo-comments","error_getting_comments"))}}};b.io("/photo_comments_fragment_2013.gne?cachebust="+(new Date()).getTime(),t)}function j(A,u){A.preventDefault();var v=A.target.ancestor(p.photoContainerSelector)||A.target.ancestor(p.commentContainerSelector),D=v.one(p.photoNodeSelector+"[data-photo-id="+u+"]")?v.one(p.photoNodeSelector+"[data-photo-id="+u+"]"):p.commentContainerSelector?A.target.ancestor(p.commentContainerSelector):v,C=(v.ancestor(p.commentContainerSelector)||v),x=C.one(".comments-popover, .comments-overlay"),B=D.one(p.commentButtonNodeSelector),r=(C.one(".comments-popover"))?true:false,z,q=D.getAttribute("data-comments-total-count"),t=parseInt(q===""?0:q,10);if(b.config.flickr.flags.enable_grease&&!b.config.flickr.user.nsid&&b.grease){var y=encodeURIComponent(x.one("form #message").get("value"));b.grease.postComment(y,u);b.grease.authenticate(function(E){});return false}var s="magic_cookie="+b.config.flickr.magic_cookie+"&photo="+u+"&addcomment=1flash_ver=unknown&offset="+(t-3)+"&limit=4&show-chrome=true&view-more-count=20&truncate-comment-body="+d(2)+"&hide-meta=true&message="+encodeURIComponent(x.one("form #message").get("value"));var w={method:"post",data:s,on:{success:function(M,L,H){var E;var I=b.Node.create(L.responseText).one(".Problem");if(I){if(I.get("text")==="An empty comment box? That won't work!"){i(b.transjax.get("photo-comments","error_empty_body"))}else{i(b.transjax.get("photo-comments","error_add_generic"))}x.one(".comment-content .html5-balls").remove();x.one(".comment-content form").show();return}n={};if(r){var G=t,K=G+1,J;z=D.get("parentNode");B.setAttribute("class","");if(K<10){B.addClass("counter1");J="counter1"}else{if(K<100){B.addClass("counter2");J="counter2"}else{B.addClass("counter3");J="counter3";B.one(p.counterSelector||".li_counter").hide();if(B.one(".li_99_plus")){B.one(".li_99_plus").show()}}}B.addClass(p.commentButtonNodeClass||"il_comments");B.addClass("rapidnofollow");B.removeClass("active");B.one(p.counterSelector||".li_counter").set("text",K);if(z.get("parentNode").hasClass("card-bundle")){E=D.getAttribute("data-photo-id");z.one(".id"+E).setAttribute("data-comment_class",J).setAttribute("data-comment_count",K)}f()}else{x.one(".comments-inner").set("innerHTML",L.responseText);if(x.one(".comment-button-post")){x.one(".comment-button-post").on("click",function(N){j(N,u)})}}D.setAttribute("data-comments-total-count",t+1)},failure:function(E,G){x.one(".comment-content .html5-balls").remove();x.one(".comment-content form").show();x.one(".comment-content textarea").focus();i(b.transjax.get("photo-comments","error_add_generic"))}}};x.one(".comment-content form").hide();x.one(".add-comment-form .comment-content").append('<span class="html5-balls"><span class="blueball"></span><span class="pinkball"></span></span>');b.io("/photo_comments_fragment_2013.gne?cachebust="+(new Date()).getTime(),w)}function m(q){q.all(".card-comment").each(function(w){if(!w.one(".comments-overlay")){var v=w,r=v.getAttribute("data-photo-id"),u=v.one(".commentsWrapper");totalComments=parseInt(v.getAttribute("data-comments-total-count"));var s="magic_cookie="+b.config.flickr.magic_cookie+"&photo="+r+"&offset="+(totalComments-4)+"&limit=4&show-chrome=true&view-more-count=20&truncate-comment-body="+d(2)+"&hide-meta=true";var t={method:"post",data:s,on:{success:function(A,z,y){if(u.one(".comments-overlay")){return}var x;if(u.one(".action-view-comments")){u.one(".action-view-comments").remove()}u.append('<div id="comments" class="comments-overlay"><div class="comments-inner">'+z.responseText+"</div></div>");x=u.one(".comment-button-post");if(x){x.on("click",function(B){j(B,r)})}b.refreshSIHPSidebar.updateConfig()},failure:function(z,y,x){}}};b.io("/photo_comments_fragment_2013.gne?cachebust="+(new Date()).getTime(),t)}})}function d(q){var r=b.one(p.container).get("offsetWidth");if(r<=640){return 50*q}else{return 70*q}}function k(r){r.preventDefault();var q=r.target.ancestor("li.comment-block");q.one(".truncated-comment").hide();q.one(".whole-comment").show()}function g(s){s.preventDefault();var q,r;q=s.target.ancestor(".comment-block").one(".comment-buddy-icon-link");if(q){r="[http://www.flickr.com/photos/"+q.get("href").replace(/^.*?\/photos\/(.*?)\/$/,"$1")+"]"}if(r){var t=r+" ";s.target.ancestor(".comments-inner").one("#message").focus();s.target.ancestor(".comments-inner").one("#message").set("value",t)}}function i(q){i.alert=i.alert||new b.FlickrDialog.Alert({message:q,width:280});i.alert.show()}function l(q){h({target:q.one(".comments-inline-btn")})}var f=function(){var t=b.one(".comments-popover"),s;if(t){var u=b.one(".popover-shim"),r=t.ancestor(p.commentContainerSelector),q=r.all(p.commentButtonNodeSelector||".il_comments");t.remove();u.remove();q.removeClass("active");if(p.onDismiss){p.onDismiss(r)}delete b.config[a].open_cards[parseInt(r.getData("photo-id"),10)];n={}}};c.prototype.dismissCommentsPopover=f;c.prototype.loadCommentsCards=m;c.prototype.openForNode=l;c.prototype.getDismissEvent=function(){return e};b.refreshSIHPComment=c},"0.0.1",{requires:F.config.modules[a].requires||[],optional:F.config.modules[a].optional||[]})}());(function(){var a="refresh-sihp-share";YUI.add(a,function(b){var d,e,k;var c;function j(l){if(!b.Lang.isObject(l)){return}k=l;c=l.container;if(b.Lang.isString(c)){c=b.one(c)}if(!b.Lang.isObject(c)||!c.getDOMNode){return}k.shareIconSelector=k.shareIconSelector||".il_share .li_icon";k.a_nodeSelector=k.a_nodeSelector||"li";k.imgWrapperSelector=k.imgWrapperSelector||".imgWrapper";k.shareButtonSelector=k.shareButtonSelector||"li";c.delegate("click",g,k.shareIconSelector);if(k.altButtonSelector){b.one(k.altButtonSelector).on("click",i)}e=k.dismissCommentEvent}function i(n){n.preventDefault();b.config.flickr.sharing={use_share_this_v3:true,object:{id:k.altId,owner_nsid:k.altOwner,type:k.altType,},shareability_is_unknown:true};var l=b.one(k.altButtonSelector);var m=l.one("a");h(m);m.removeClass("sn-ico-share");if(!b.shareThisV3Menu.isInitialized()){b.refreshSIHPShare.menu=b.shareThisV3Menu.init({button_node:l,arrowPosition:"tr",overrideRefresh:k.overrideRefresh||overrideRefresh,scroll:true,bottom:k.bottom,right:k.right,afterInit:function(){f(m);m.addClass("sn-ico-share");b.shareThisV3Menu.show()}})}else{if(!b.shareThisV3Menu.getMenu().get("popover").get("visible")){b.shareThisV3Menu.hide();b.shareThisV3Menu.clear();b.shareThisV3Menu.getMenu().set("button_node",b.one(k.altButtonSelector));b.shareThisV3Menu.refresh(function(){f(m);m.addClass("sn-ico-share");b.shareThisV3Menu.show()})}else{f(m);m.addClass("sn-ico-share")}}}function g(q){q.preventDefault();b.fire(e);var r=q.target.ancestor(k.shareIconSelector,true),u=q.target.ancestor(k.a_nodeSelector),v=r.ancestor(k.imgWrapperSelector),m=v&&v.getAttribute("data-photo-id"),n=v&&v.getAttribute("data-photo-owner"),p=q.target.ancestor(k.shareButtonSelector);if(m&&n){if(d===v.getDOMNode().id){d=null}else{d=v.getDOMNode().id;b.config.flickr.sharing={use_share_this_v3:true,shareability_is_unknown:true,object:{id:m,owner_nsid:n,type:"photo"}};var s="br",l,t;if(v.ancestor(".firstCard")){(function o(){function x(y){var z={x:0,y:0};while(y){z.x+=y.offsetLeft;z.y+=y.offsetTop;y=y.offsetParent}return z}var w=x(r.getDOMNode());if(w.y<411){s="tr";l=true;t=true}})()}if(!b.shareThisV3Menu.isInitialized()){h(u);b.refreshSIHPShare.menu=b.shareThisV3Menu.init({button_node:r,arrowPosition:k.pos||s,overrideRefresh:k.overrideRefresh||l,scroll:k.scroll||t,bottom:k.bottom,right:k.right,afterInit:function(){f(u);b.shareThisV3Menu.show();if(k.inlineRealign){var w=b.one("#share-menu-v3").siblings(".yui3-popover-arrow").item(0);var y=w.getStyle("top");var x=w.getStyle("right");if(y&&x){y=parseInt(y.replace("px",""),10);x=parseInt(x.replace("px",""),10);y=y+k.adjustTop;x=x+k.adjustRight;w.setStyle("top",y+"px").setStyle("right",x+"px")}}p.addClass("active");if(k.onSuccess){k.onSuccess(v,p)}},onHide:function(){if(k.onDismiss){k.onDismiss(v,p)}}})}else{b.shareThisV3Menu.hide();b.shareThisV3Menu.clear();h(u);b.shareThisV3Menu.getMenu().set("button_node",r);b.shareThisV3Menu.getMenu().set("onHide",function(){if(k.onDismiss){k.onDismiss(v,p)}});b.shareThisV3Menu.refresh(function(){f(u);b.shareThisV3Menu.show();p.addClass("active");if(k.onSuccess){k.onSuccess(v,p)}if(k.inlineRealign){var w=b.one("#share-menu-v3").siblings(".yui3-popover-arrow").item(0);var y=w.getStyle("top");var x=w.getStyle("right");if(y&&x){y=parseInt(y.replace("px",""),10);x=parseInt(x.replace("px",""),10);y=y+6;x=x+8;w.setStyle("top",y+"px").setStyle("right",x+"px")}}})}}}}function h(l){if(l.one(".li_icon")){l.one(".li_icon").hide()}else{if(k.onLoading){k.onLoading(l)}}l.append('<span class="html5-balls"><span class="blueball"></span><span class="pinkball"></span></span>')}function f(l){l.one(".html5-balls").remove();if(l.one(".li_icon")){l.one(".li_icon").show()}}b.refreshSIHPShare={init:j}},"0.0.1",{requires:F.config.modules[a].requires||[],optional:F.config.modules[a].optional||[]})}());(function(){var c="photos-list";YUI.add(c,function(ad){var i=window.location,aC,W=265,ae=".photo-display-item",aM,w,I,s,ar,x,D=false,g=false,au=false,M=null,aL=53,aG=ad.config.flickr.flags.enable_2013_photo_page?10:43,r=100,aR=300,G=975,aJ=null,o=false,aD=false,aj=false,u=false,av=0,t=1,aU="gsb-",h,ac=false,J=false,T,p,E,X,aq,v=(screen&&screen.width>500&&window.devicePixelRatio>1)?true:false,ao=0,ab=ad.config.flickr.flags.enable_justified_view_inline_commenting,l,R,aE=1,X,af,N=["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"],e={gecko:{p:"moz-",tp:"MozTransform"},webkit:{p:"webkit-",tp:"WebkitTransform"},opera:{p:"o-",tp:"OTransform"},ie:{p:"ms-",tp:"msTransform"}},z={},aa=ad.UA,q;for(q in e){if(e.hasOwnProperty(q)&&aa[q]){z=e[q]}}var Q=(function(){var Y;return function(aX){return Y||(Y=z.p+aX)}}());var aV=(function(){var Y=true;if(ad.UA&&ad.UA.ie&&ad.UA.ie<8){Y=false}return function(){return Y}}());var ah=(function(){var aX=false,Y=false;return function(aY,aZ){if(!Y||aZ){if(aY.hasClass("ju")){aX=true}Y=true}return aX}}());var ax=(function(){var aY,aX=false,aZ=document.body.style,Y=N.length,a0;a0=document.body.style;for(aY=0;aY<Y;aY++){if(aZ[N[aY]]!==undefined){aX=true}}return function(){return aX}}());function n(Y){darkList=Y.all(".photo_container img:not(.pc_link img)");darkList.each(function(aY){var aX=new Image();aX.src=aY.get("src").replace(/_s|_t|_m|_z/,"_n")})}function aW(aX,Y){n(aX);page_type=ad.config.flickr.page_type;urlParts=ad.urls.parse(page_type,location.pathname+location.search);paginator=ad.one("#paginator-module .this-page");if(!paginator){return}if(!urlParts.page){urlParts.page=1;if(paginator){urlParts.page=parseInt(ad.one("#paginator-module .this-page").get("innerHTML"),10)}}var aY=ad.urls.get(page_type,urlParts)+"?fragment=1";function a0(a4,a3,a2){var a1=ad.Node.create("<div></div");a1.innerHTML=a3.responseText;n(a1)}for(var aZ=1;aZ<3;aZ++){urlParts.page++;aY=ad.urls.get(page_type,urlParts)+"?fragment=1";ad.io(aY,{on:{success:a0},arguments:{page:urlParts.page}})}}function O(){if(ad.UA.webkit){return}var a0,aX;if(ad.UA.webkit){a0=document.body.scrollTop}else{a0=document.documentElement.scrollTop}aX=a0+window.innerHeight;var Y=k();var aZ=Y.filter(function(a3){var a4=ad.DOM.getXY(a3),a1=a4[1],a2;if(a1<=a0||a1>=aX){return true}else{return false}});var aY=Y.filter(function(a3){var a4=ad.DOM.getXY(a3),a1=a4[1]+aF,a2;if(a1<=a0){return false}else{return true}});aZ.addClass("hideimg");aY.removeClass("hideimg")}function C(Y){Y=ad.Lang.isObject(Y)?Y:{};if(Y.min_photo_width){W=Y.min_photo_width}if(Y.photo_selector){ae=Y.photo_selector}if(Y.faves_owner_nsid){aM=Y.faves_owner_nsid}if(Y.faves_owner_name_possessive){w=Y.faves_owner_name_possessive}if(Y.group_id){I=Y.group_id;h=aU+I;cacheKeyHashed=ad.murmurhash(h,25)}}function al(a1,aX){var a4,a2,aY,a7;if(aX.viewMode==="sm"){R=aX.viewMode}if(aX.viewMode==="ju"){}if(ad.config.flickr.flags.enable_justified_view_inline_commenting){ad.one(a1).all(".photo-display-item").setStyle("zIndex","inherit");l=new ad.refreshSIHPComment({container:a1,commentIconSelector:".comments-inline-btn",photoContainerSelector:".photo-display-item",commentButtonNodeSelector:".comments-inline-btn",commentButtonNodeClass:"comments-icon comments-inline-btn",counterSelector:".comment-count",edgeDetection:true,arrowOffset:37,onLoading:function(bb){bb.empty()},onSuccess:function(bc,bb,bd){bc.addClass("inline-commenting");bb.append('<img class="spaceball" width="12" height="12" src="/images/spaceball.gif" >');bb.append('<span class="comment-count count">'+(bd>0?bd>99?"99+":bd:"")+"</span>")},onDismiss:function(bb){bb.removeClass("inline-commenting")}})}if(ad.config.flickr.flags.enable_justified_view_inline_sharing){ad.config.flickr.sharing.use_share_this_v3=false;ad.refreshSIHPShare.init({container:".photo-display-container",shareIconSelector:".share-inline",a_nodeSelector:".share-inline",imgWrapperSelector:".photo-display-item",shareButtonSelector:".share-inline",dismissCommentEvent:l.getDismissEvent(),altButtonSelector:ad.one("#share-this-v3-more-button")?"#share-this-v3-more-button":null,altId:F.config.flickr.sharing&&F.config.flickr.sharing.object?F.config.flickr.sharing.object.id:null,altOwner:F.config.flickr.sharing&&F.config.flickr.sharing.object?F.config.flickr.sharing.object.owner_nsid:null,altType:F.config.flickr.sharing&&F.config.flickr.sharing.object?F.config.flickr.sharing.object.type:null,pos:"tr",scroll:true,adjustTop:6,adjustRight:8,overrideRefresh:true,inlineRealign:true,onLoading:function(bb){bb.empty()},onSuccess:function(bb,bc){bb.addClass("inline-share");bc.append('<img class="spaceball" width="12" height="12" src="/images/spaceball.gif" >')},onDismiss:function(bb,bc){bb.removeClass("inline-share");bc.removeClass("active")}})}if(ad.config.flickr.is_touch_device&&ad.config.flickr.flags.enable_touch_lightbox_searchified){D=true}aC=a1;a7=F.config.flickr.flags.enable_uh_eyebrow?ad.one("#eyebrow").get("offsetHeight"):0;ao=F.config.flickr.flags.enable_global_nav?ad.one("#global-nav").get("offsetHeight")+a7:0;if(ad.Lang.isString(aC)){aC=ad.one(aC)}if(!aC instanceof ad.Node){return false}C(aX);var a9;var a3=false;if(ad.one("body").hasClass("breakout")||ah(aC)){if(ah(aC)){aC.addClass("loading")}var Y=ad.one("#group-sidebar");if(Y){var a0=ad.one(".photo-display-container"),aZ=(a0.getY()-ad.one("#main").getY());var ba=Y.all(".group-description a");if(ba){ba.setAttribute("data-track","ugc-link")}Y.all(".toggle, .hide-link").on("click",function(bb){bb.preventDefault();if(ab){ad.fire(l.getDismissEvent())}if(J){Y.removeClass("open");J=false;aC.setStyle("paddingLeft","0px");K(aC,true);if(window.localStorage){window.localStorage.setItem(cacheKeyHashed,t)}}else{Y.addClass("open");J=true;K(aC,true);if(window.localStorage){window.localStorage.setItem(cacheKeyHashed,av)}}am(J)});var a6=ad.one("#group-sidebar");var a8=false;a6.setStyle("top",aZ+"px")}function a5(){if(R==="sm"){return}var bc,bg,bf,be,bd,bb;if(X){X.cancel()}if(!ad.UA.webkit){O()}if(ac){ad.one("#pool-photos").setStyle("min-height",a6.get("offsetHeight")+"px")}if(Y&&!ac&&(window.innerHeight>a6.get("offsetHeight")+aC.getY())){if(p){bc=p}else{bc=a6.get("offsetHeight");p=bc}bg=window.innerHeight;a=bg-bc;bf=aq;if(E){bb=E}else{bb=aC.getY();E=bb}be=bf+bb;bd=be-window.scrollY;b=bg-bd;if(a<=b){if(!a8){a6.setStyle("position","absolute").setStyle("top",(bf+bb-bc)-90+"px");a8=true}a3=false}else{if(!a3&&window.pageYOffset>=a0.getY()-ao+9){a8=false;a6.setStyle("position","fixed").setStyle("top",(5+ao)+"px");a3=true;ad.one(".group-hideable").setStyle("height","0px");ad.later(1,this,function(){j(ad.one("#group-sidebar"))})}else{if(window.pageYOffset<=a0.getY()-ao+9){a8=false;a6.setStyle("position","absolute").setStyle("top",aZ+"px");a3=false;ad.one(".group-hideable").setStyle("height","110px")}}}if(ad.config.flickr.flags.enable_justified_groups){ad.one(".group-hideable").setStyle("height","0px")}}}ad.on("scroll",ad.betterThrottle(a5,25));K(aC);j(ad.one("#group-sidebar"));ad.on("resize",function(){aN.regions={};if(a9&&a9.cancel){a9.cancel();a9=false}a9=ad.later(100,this,function(){K(aC);j(ad.one("#group-sidebar"))})})}if(!ah(aC)&&ad.config.flickr.darklaunch_n){ad.later(200,this,aW,[aC,true])}if(ah(aC)){aC.delegate("mouseover",function(bc){var bb=this.get("id").replace("photo_","");aJ=bb},".photo-display-item");if(ad.config.flickr.justify_zoom){ad.one("body").delegate("click",function(bc){var bb=this.getAttribute("href");if(bc.button!==1||bc.ctrlKey||bc.metaKey){return}bc.preventDefault();if(this.getAttribute("data-track")){ad.rapidTracker.beaconClick("thumbnails",this.getAttribute("data-track"))}if(!ab&&(targ.hasClass("comments-inline-btn")||!this.test(".rapidnofollow")||this.hasClass("comments-icon")||this.getAttribute("data-track")=="photo-click"||this.hasClass("lightbox-inline"))){if(aJ){ad.historyManager.pushState({photo_id:aJ})}window.location=bb}},".zoomer .thumb a")}if(!ab&&(!ad.UA.ie||ad.UA.ie>9)){aC.delegate("click",function(bd){if(bd.button!==1||bd.ctrlKey||bd.metaKey){return}var bb=this.getAttribute("href");bd.preventDefault();if(aJ){var bc=ad.historyManager.getState();bc.lightbox=false;bc.photo_id=aJ;ad.historyManager.pushState(bc)}if(bb!=="#"){window.location=bb}},".thumb > a, .thumb span:not(.inline-icons) a, .thumb a.comments-icon")}}if(ad.config.flickr.lightbox.enable){ar=true;aT()}if(ad.one("#thumb-options")){Z({menuNode:ad.one("#thumb-options"),buttonNode:ad.one("#options-thumb"),width:"130px",context:"thumb-options-menu",onItemClick:function(be){var bb,bd,bc;be.preventDefault();bb=be.target.getAttribute("data-view-mode");bc=be.target.getAttribute("href");if(ad.config.flickr.view_mode_cookie_name){az(ad.config.flickr.view_mode_cookie_name,bb,1000*60*60*24*365)}H("view_mode.change","view_mode_change");bd=aC.hasClass("sq")?"sq":aC.hasClass("sm")?"sm":aC.hasClass("md")?"md":aC.hasClass("ju")?"ju":"lg";if(ad.config.flickr.flags.norefresh_searchified&&bd!=="ju"){aC.addClass("loading");ad.io(window.location.pathname+"?view="+bb+"&fragment=1",{on:{success:function(bh,bg){var bf=bg.responseText.split("<!--cont-->");aC.removeClass(bd).addClass(bb);aC.setContent(bf[1]);ad.deferImages("#pool-photos img.defer");ah(aC,true);K(aC,true);aC.removeClass("loading")}}})}else{window.setTimeout(function(){i.href=bc},100)}}})}if(ad.one("#who-options")){Z({menuNode:ad.one("#who-options"),buttonNode:ad.one("#options-who"),width:"150px",context:"who-options-menu"})}if(ad.one("#howmany-options")){Z({menuNode:ad.one("#howmany-options"),buttonNode:ad.one("#options-howmany"),width:"130px",context:"howmany-options-menu"})}if(ad.config.flickr.flags.enable_faves_manage){aC.delegate("click",L,".fave-star-inline");aC.delegate("click",aK,".delete-x-inline")}else{if(ah(aC)){aC.delegate("click",L,".fave-star-inline")}}ad.paginationKeyboardShortcuts();if(ah(aC)&&ad.config.flickr.justify_zoom){ad.keyboardShortcutManager.register({keystring:"27",handler:function(bb){hideAllZoomers()},context:""})}ad.keyboardShortcutManager.register({keystring:"32",handler:function(bb){if(bb.shiftKey){if(aS()){bb.preventDefault()}}else{if(U()){bb.preventDefault()}}},context:""});ad.keyboardShortcutManager.register({keystring:"74,75",handler:function(bb){if(parseInt(bb.keyCode,10)===75){aP(true)}else{aP()}},context:""});if(ad.config.flickr.flags.enable_keyboard_shortcut_legend&&ad.keyboardShortcutLegend&&ad.keyboardShortcutLegend.register){ad.keyboardShortcutLegend.register({keyCodes:[32],key:"space",description:ad.transjax.get("photos-list","scroll_down"),group:ad.transjax.get("keyboard-shortcut-legend","navigation"),order:10});ad.keyboardShortcutLegend.register({keyCodes:[32,16],key:"shift + space",description:ad.transjax.get("photos-list","scroll_up"),group:ad.transjax.get("keyboard-shortcut-legend","navigation"),order:10});ad.keyboardShortcutLegend.register({keyCodes:[74],key:"J",description:ad.transjax.get("photos-list","scroll_to_next_row"),group:ad.transjax.get("keyboard-shortcut-legend","navigation"),order:0});ad.keyboardShortcutLegend.register({keyCodes:[75],key:"K",description:ad.transjax.get("photos-list","scroll_to_prev_row"),group:ad.transjax.get("keyboard-shortcut-legend","navigation"),order:0})}ad.on("video:play",function(bc){var bb=bc.node.ancestor(".photo-display-item");bb.addClass("swf-activated")});ad.on("PhotoData:is_faveChange",function(be){var bb,bc,bf,bd="fave-star-inline-faved";bb=be.target;if(bb.get("id")){bc=bb.get("id");bf=k().filter('[data-photo-id="'+bc+'"]');if(bf.size()){bf.each(function(bh){var bg=bh.one(".fave-star-inline"),bi=bh.one(".fave-count");if(bg&&(be.newVal&&!bg.hasClass(bd)||!be.newVal&&bg.hasClass(bd))){V(bg,be.newVal,bb.get("media"),bd);if(bi){ak(bi,(be.newVal&&!bg.hasClass(bd))?1:-1)}}})}}});if(ad.config.flickr.flags.enable_polling_for_searchified_activity){setTimeout(function(){var be=ad.ContextData.getContext(ad.config.flickr.open_context_id).prev_limit,bc=ad.config.flickr.per_page,bb,bd;if(be>bc*-1){ad.on("ContextData:photoLoaded",function(bh){if(!bb){var bf=ad.ContextData.getContext(bh),bg=bf.prev_limit;if(bf.getPhoto(bg-1)){clearInterval(bd);aC.prepend('<p class="alert"><span class="msg-icon"></span>'+ad.transjax.get("photos-list","polling_found_more_photos")+"</p>")}}});bd=setInterval(function(){ad.ContextData.getContext(ad.config.flickr.open_context_id).fetch(-1,true)},30000)}},30000)}return false}function V(aX,Y,aZ,aY){var a0;if(Y){aX.addClass(aY);a0=aZ==="video"?"remove_fave_video":"remove_fave_photo"}else{aX.removeClass(aY);a0=aZ==="video"?"add_fave_video":"add_fave_photo"}aX.setAttribute("title",ad.transjax.get("photos-list",a0))}function aK(aZ){var a3,a7,aX,a4,a0,a5,Y,a2,aY,a6,a1;aZ.preventDefault();a3=aZ.currentTarget;a7=a3.ancestor(ae);if(!a3||!a7){return}aK.pending_deletes=aK.pending_deletes||{};aX=a7.getAttribute("data-photo-id");a2=a7.getAttribute("data-photo-owner")===ad.config.flickr.user.nsid;aY={CONFIRM:ad.transjax.get("photos-list","yes_remove_it"),width:330,confirm_butt_class:"DeleteButt"};a4=a7.one("img.pc_img");a0=a4&&(a4.getAttribute("src")||a4.getAttribute("data-defer-src"));if(a0){aY.photo={url:a0};a5=a4.getAttribute("width");Y=a4.getAttribute("height");if(a5&&Y){if(a5>240){Y=240*Y/a5;a5=240}if(Y>240){a5=240*a5/Y;Y=240}aY.photo.width=a5;aY.photo.height=Y}}a6=function(a8){if(a8){aH(a7)}};switch(ad.config.flickr.page_type){case"contactsfaves":case"faves":if(a2){if(w){a1=ad.transjax.get("photos-list","confirm_remove_your_photo_from_specific_members_favorites","<b>"+ad.StringFilters.escape_entities(w)+"</b>")}else{a1=ad.transjax.get("photos-list","confirm_remove_your_photo_from_this_members_favorites")}}else{a1=ad.transjax.get("photos-list","confirm_remove_their_photo_from_your_favorites")}break;case"group_pool":if(ad.config.flickr.group&&(ad.config.flickr.group.is_admin||ad.config.flickr.group.is_moderator)){a6(true);return}if(a2){a1=ad.transjax.get("photos-list","confirm_remove_your_photo_from_group_pool")}else{a1=ad.transjax.get("photos-list","confirm_remove_their_photo_from_group_pool")}break}if(ad.config.flickr.page_type!=="faves"){ad.global_dialog.create_confirmation_dialog("<div>"+a1+"</div>",a6,aY)}else{a6(true)}}function aH(a5){var a2,aY,aZ,Y,a1,a3;a2=a5.one(".delete-x-inline");aY=a5.getAttribute("data-photo-id");if(ad.ContextData){aZ=ad.ContextData.getContext(ad.config.flickr.open_context_id);if(aZ){Y=aZ.id;a1=aZ.getPhotoPosition(aY)}}function aX(){if(aK.context_listeners&&aK.context_listeners[aY]){ad.log("detach "+aK.context_listeners[aY].length+" context event(s) for photo "+aY,"info",c);ad.Array.each(aK.context_listeners[aY],function(a6){if(a6.detach){a6.detach()}});aK.context_listeners[aY]=undefined;delete aK.context_listeners[aY]}}function a4(a7,a8,a6){if(a7===Y){ad.log("handle adjacent photo loaded for photo "+aY,"info",c);if(aK.pending_deletes[aY]){ad.log("Now it's safe to remove the favorite for photo "+aY,"info",c);aK.pending_deletes[aY]=undefined;delete aK.pending_deletes[aY];aA(a5);aX()}}}function a0(a6){var a7;if(a6===Y){ad.log("handle adjacent photo not loaded for photo "+aY,"info",c);a7=aZ.getLoadedPositions();if(a7.length===1&&a7[0]===a1){if(ad.Lang.isNumber(aZ.prev_limit)&&aZ.prev_limit>=a1&&ad.Lang.isNumber(aZ.next_limit)&&aZ.next_limit<=a1){ad.log("There aren't any photos to the left or right of the photo being removed. The context is dead, so the photo can be removed","info",c);aA(a5);aX();ad.ContextData.remove(Y)}else{ad.log("We haven't loaded an acceptible photo, but the edges of the context haven't been reached.","info",c)}}}}a2.setStyle("display","none");a3=new ad.Anim({node:a5,to:{opacity:0.3},duration:0.4,easing:ad.Easing.easeOut});a3.run();if(ar&&Y&&ad.Lang.isNumber(a1)){ad.log("photo is loaded in the lightbox, validate context ("+(ad.Object.size(aZ.photos)-ad.Object.size(aZ.removed))+" loaded, "+(1+ad.Object.size(aK.pending_deletes))+" pending removal)","info",c);if(ad.Object.size(aZ.photos)-ad.Object.size(aZ.removed)>1+ad.Object.size(aK.pending_deletes)){ad.log("we have enough photos in the context, so remove the photo","info",c);aA(a5)}else{ad.log("we need more photos in the context, so load more context data before removing the photo","info",c);aK.pending_deletes[aY]=true;aK.context_listeners=aK.context_listeners||{};aK.context_listeners[aY]=aK.context_listeners[aY]||[];aK.context_listeners[aY].push(ad.on("ContextData:photoLoaded",a4));aK.context_listeners[aY].push(ad.on("ContextData:photoLoadFailure",a0));aK.context_listeners[aY].push(ad.on("ContextData:prevLimitReached",a0));aK.context_listeners[aY].push(ad.on("ContextData:nextLimitReached",a0));ad.ContextData.loadPhotoRange(Y,a1-5,a1-1);ad.ContextData.loadPhotoRange(Y,a1+1,a1+5)}}else{ad.log("this photo isn't loaded in the lightbox","info",c);aA(a5)}}function aA(aX){var aZ,aY,Y,a2,a0,a1;ad.log("removePhoto called for photo "+aY,"info",c);aZ=aX.one(".delete-x-inline");aY=aX.getAttribute("data-photo-id");Y=aX.getAttribute("data-photo-owner")===ad.config.flickr.user.nsid;switch(ad.config.flickr.page_type){case"faves":a2="flickr.favorites.remove";a0={photo_id:aY};if(Y){a0.user_id=aX.getAttribute("data-fave-owner")||aM}break;case"group_pool":a2="flickr.groups.pools.remove";a0={photo_id:aY,group_id:I};break}a1={success:function(){var a3;A(aX);if(ad.PhotoData){a3=ad.PhotoData.get(aY);if(a3){if(ad.config.flickr.page_type==="faves"){a3.set("is_fave",false)}}}switch(ad.config.flickr.page_type){case"faves":if(Y){H("manage.x_own_photo","manage_x_own_photo")}else{H("manage.x_own_favorite","manage_x_own_favorite")}break;case"group_pool":H("manage.x_own_photo_in_pool","manage_x_own_photo_in_pool");break}},failure:function(){var a3;aZ.setStyle("display","");a3=new ad.Anim({node:aX,to:{opacity:1},duration:0.4,easing:ad.Easing.easeOut});a3.on("end",function(){aX.setStyle("opacity","")});a3.run()}};ad.flickrAPI.callMethod(a2,a0,a1)}function A(aX){var Y;aX.setStyle("overflow","hidden");Y=new ad.Anim({node:aX,to:{opacity:0,width:0,height:0},duration:0.25,easing:ad.Easing.easeOut});Y.on("end",function(){aX.remove();k.memo=undefined;if(k().size()===0){i.reload()}if(ah(aC)){K(aC)}});Y.run();ay()}function ak(a0,aZ){var Y,aY,aX="fave-star-inline-faved";Y=a0.get("innerHTML");if(Y.match(/^[1-9][0-9]?$/)){aY=parseInt(Y,10);aY=aY+aZ;if(aY<1){aY="";a0.addClass("null-count")}else{if(aY>=100){aY="99+"}}}else{if(Y.match(/\+/)){return}else{a0.removeClass("null-count");aY=1}}a0.set("innerHTML",aY)}function L(a1){var a2,a5,aZ,aX,aY,Y,a0,a4,a3="fave-star-inline-faved";a1.preventDefault();a2=a1.target.ancestor(".fave-star-inline",true);a5=a2.ancestor(ae+", .zoomer");if(!a2||!a5){return}aZ=a5.getAttribute("data-photo-id");aX=a5.getAttribute("data-photo-media");aY=!a2.hasClass(a3);count_node=a5.one(".fave-count");if(count_node){ak(count_node,(aY)?1:-1)}Y="flickr.favorites."+(aY?"add":"remove");a0={photo_id:aZ};ad.PhotoData.add({id:aZ});a4={success:function(){var a6;if(ad.PhotoData){a6=ad.PhotoData.get(aZ);if(a6){a6.set("is_fave",aY)}}if(aY){H("manage.star_add","manage_star_add")}else{H("manage.star_remove","manage_star_remove")}},failure:function(){V(a2,!aY,aX,a3)}};V(a2,aY,aX,a3);ad.flickrAPI.callMethod(Y,a0,a4)}function ay(){}function an(a2,aZ){var aY,a1,a0,aX,Y;Y=ad.ContextData.getPhotoPosition(a2,aZ);if(!ad.Lang.isNumber(Y)){aY=ad.ContextData.getPhoto(a2,0);a1=parseInt(aY.get("id"),10);aZ=parseInt(aZ,10);k().some(function(a5,a4){var a3=parseInt(a5.getAttribute("data-photo-id"),10);if(a3===a1){a0=a4}if(a3===aZ){aX=a4}if(ad.Lang.isNumber(a0)&&ad.Lang.isNumber(aX)){Y=aX-a0}})}return Y}function B(aX,Y){if(D){ad.touchLightbox.open.apply(null,arguments)}else{ad.lightbox.open.apply(null,arguments)}}function aT(){var Y=D?"touch-lightbox":"lightbox";ad.use(Y,function(aZ){if(D){aZ.touchLightbox.init()}var aY=aZ.one(".options-view-lightbox"),aX={};if(aY){aY.on("click",function(a0){a0.preventDefault();B();H("lightbox.open_header","lightbox_open_header")})}aC.delegate("click",function(a5){var a1,a2,a3,a4,a0;a5.preventDefault();a1=a5.currentTarget;a2=a1.ancestor(ae);if(!a1||!a2){return}a3=a2.getAttribute("data-photo-id");a4=aZ.config.flickr.open_context_id;if(a4){a0=an(a4,a3);if(aZ.Lang.isNumber(a0)){if(a5.metaKey||a5.button===2){window.open(window.location.protocol+"//"+window.location.host+a2.one("a.title").getAttribute("href")+"/lightbox/");return}B(a4,a0);H("lightbox.open_photo","lightbox_open_photo")}}},".lightbox-inline");aZ.keyboardShortcutManager.register("76",function(a9){a9.preventDefault();aZ.fire("flickr-menus:hide");var bc,a6,a8,a0,a2,a1,a7,bb;if(x){bc=k().filter('[data-photo-id="'+x+'"]');if(bc){bc=bc.item(0);a6=aN(bc);if(a6&&a6[0]){a8=true;aZ.log("the last photo in the lightbox is still visible on the page, so reopen it","info",c)}}}if(!a8&&aZ.ContextData){a0=aZ.config.flickr.open_context_id;if(a0&&k()&&k().size()){var a5=at();var ba=ai(a5);var a4=ba[0];var a3=ba[1];if(aZ.Lang.isNumber(a4)){a1=a4}else{if(aZ.Lang.isNumber(a3)){a1=a3}}a7=a5.item(a1);bb=a7.getAttribute("data-photo-id");a2=aZ.ContextData.getPhotoPosition(a0,bb);if(!aZ.Lang.isNumber(a2)){a2=an(a0,bb)}}}if(D){aZ.touchLightbox.init(false)}if(a0&&aZ.Lang.isNumber(a2)){B(a0,a2)}else{B()}H("lightbox.open_keypress","lightbox_open_keypress")},"");if(aZ.config.flickr.flags.enable_keyboard_shortcut_legend&&aZ.keyboardShortcutLegend&&aZ.keyboardShortcutLegend.register){aZ.keyboardShortcutLegend.register({keyCodes:[76],key:"L",description:aZ.transjax.get("photos-list","view_photos_in_lightbox"),group:aZ.transjax.get("keyboard-shortcut-legend","lightbox"),order:0})}aZ.on("lightbox:closed",function(a0){var a1;if(a0.photo.get("id")){x=a0.photo.get("id");a1=k().filter('[data-photo-id="'+a0.photo.get("id")+'"]');if(a1&&a1.item(0)){a1.item(0).vis.animScrollIntoView(true,5)}}});if(aZ.config.flickr.page_type==="faves"&&aZ.config.flickr.page_owner===aZ.config.flickr.user.nsid){aZ.after("PhotoData:is_faveChange",function(a3){var a0=a3.target,a1=a0.get("id"),a2;if(!D&&aZ.lightbox.isOpen()&&a0.get("initialized")){if(a3.newVal){if(aZ.ContextData&&k().filter('[data-photo-id="'+a1+'"]').size()===0){a2=aZ.config.flickr.open_context_id;aZ.ContextData.invalidate(a2)}else{if(aX[a1]){aX[a1]=undefined;delete aX[a1]}}}else{if(!aX[a1]){aX[a1]=a0}}}});aZ.on("lightbox:closed",function(a0){aZ.Object.each(aX,function(a1,a2){if(a1){var a3=k().filter('[data-photo-id="'+a2+'"]');a3.each(function(a4){A(a4)})}});aX={}})}})}function Z(Y){var aX,aY;if(!Y.buttonNode){return}aX=new ad.Popover({srcNode:Y.menuNode,width:Y.width,visible:false});aX.render();aY=ad.menus.add({id:ad.guid(),popover:aX,context:Y.context,button_node:Y.buttonNode});Y.menuNode.all("a").on("click",function(aZ){if(aZ.target.hasClass("selected")){aZ.preventDefault()}else{if(Y.onItemClick){Y.onItemClick(aZ)}}})}var y=[],aF=parseInt(ad.config.flickr.justified_row_height,10),d=8,ag={};function aw(aX){var Y=aX.finalWidth,aZ=aX.ownerWidth,aY=Y-aZ;if(Y>400){return"wide"}if(aY>155&&Y>150){return"n"+aY}if(aY>r){return"narrow"}if(Y>150&&aY<20){return"too-narrow"}if(Y<50){return"waytoo-narrow"}if(Y<100){return"too-narrow"}if(Y<130){return"crazy-narrow"}if(Y<150){return"too-narrow"}if(aZ>45){return"too-narrow"}return"crazy-narrow"}var aB=["t","m","n","c","b","h","k"];function aI(a5,a9){if(ad.config.flickr.flags.enable_retina_justified&&v){a9=a9*2}var aY=a5.sizes;var bc=ad.Array.map(ad.Object.keys(aY),function(bd){return{width:aY[bd][0],height:aY[bd][1],size:bd}}).sort(function(be,bd){return bd.height-be.height});var ba,aX,a6;var a7=0.05;var aZ=0,bb;var a3=bc[0];var a8,a1,Y,a2;var a0=ad.config.flickr.static_domain;while(bc[aZ]){bb=bc[aZ++];if(bb.height<a9){a8=a3;a1=bb;a6=a9*a7;ba=Math.abs(a8.height-a9);aX=Math.abs(a1.height-a9);if(aX<ba&&aX<=a6){Y=a1}else{Y=a8}a2=Y.size;if(a2!=="l"){if(a2=="h"||a2=="k"){secret=a5["s"+a2];var a4=new RegExp("("+a0+"/[0-9]+/[0-9]+_)([0-9a-f]+)");a5.src=a5.src.replace(a4,"$1"+secret)}else{secret=a5.secret;var a4=new RegExp("("+a0+"/[0-9]+/[0-9]+_)([0-9a-f]+)");a5.src=a5.src.replace(a4,"$1"+secret)}return a5.src.replace(/_[a-z]\.jpg|\.jpg/,"_"+a2+".jpg")}else{secret=a5.secret;var a4=new RegExp("("+a0+"/[0-9]+/[0-9]+_)([0-9a-f]+)");a5.src=a5.src.replace(a4,"$1"+secret);return a5.src.replace(/_[a-z]\.jpg|\.jpg/,".jpg")}}a3=bb}}var P=ad.one("#group-sidebar");function ap(bp){var bt,a4,bm,bs,bf,bo,bq,bn,aZ,a0,a5=[0,0],a3,bc,a8,a6,a9,be,bj=0,bg=0,bi=0,a1=0,bb;bp.all(".photo-display-item .photo_container a").setAttribute("title","");bt=bp.all(".photo-display-item");if(!bt.size()&&ad.one("#empty-state")){ad.one("#empty-state").show()}bp.all(".photo-display-item img").addClass("img");if(parseInt(ad.config.flickr.justified_row_height,10)==210&&!ad.config.flickr.justify_zoom){if(ad.DOM.winWidth()>1500||ad.DOM.winHeight()>1500){aF=310}else{aF=210}}if(!ap.brokenOut){ad.one("body").addClass("breakout");ad.one("#main").setStyle("width","auto");ap.brokenOut=true}k.memo=null;a4=ad.Node.create("<div>");if(y.length!==bt.size()){y=[];bt.each(function(bw){var bv={},by,bx,bu=bw.get("id");if(ag[bu]){bv=ag[bu]}else{by=bw.one("img.pc_img");bx=ad.JSON.parse(decodeURIComponent(by.getAttribute("data-thumbdata")));bv=bx;bv.src=by.getAttribute("data-defer-src");bv.thumbNode=by.ancestor(".thumb",true);bv.attribution=bw.one(".attribution");bv.ownerWidth=bw.one("a.owner").get("offsetWidth");if(!bv.src){bv.src=by.getAttribute("src")}bv.node=bw;ag[bu]=bv}a4.appendChild(bv.node);y.push(bv)})}else{bm=y.length;for(bj=0;bj<bm;bj++){a4.appendChild(y[bj].node)}}bm=y.length;if(window.innerWidth){T=window.innerWidth-(aG*2)}else{T=ad.DOM.winWidth()-(aG*2)}if(T<G){T=G}if(window.innerWidth<400){aG=0;T=window.innerWidth-(aG*2)}if(J){T=T-(aR+45);bp.setStyle("paddingLeft",(aR+45)+"px")}bp.setStyle("width",(T-(ad.config.flickr.flags.enable_2013_photo_page?20:9))+"px");bf=T;f(bf,P?"groups":null);bo=bf-7;if(bt.size()){bp.set("innerHTML","<span></span>")}bn=0;a0=1;a3=bp.create('<div class="row"></div>');bb=bm;a6=[];for(bj=0;bj<bm;bj++){bc=y[bj];a8=y[bj].node;a8.setAttribute("title","");if(ad.config.flickr.justify_zoom){a8.addClass("unzoomed")}if(bc.sizes.k){a5=bc.sizes.k}else{if(bc.sizes.h){a5=bc.sizes.h}else{if(bc.sizes.b[0]===0){a5=bc.sizes.l}else{a5=bc.sizes.b}}}a0=aF/a5[1];if(a0>1){a0=1}a3.appendChild(a8);a9=a8.one(".photo_container img");a9.setAttribute("height",aF);a9.setAttribute("width",Math.round(a5[0]*a0));if(a5[1]<aF){a9.set("src","/images/spaceout.gif");a9.setAttribute("width",a5[0]);if(bc.sizes.b[0]===0){a9.setStyle("background",'#fefefe url("'+bc.src.replace(/_[a-z]\.jpg|\.jpg/,".jpg")+'") no-repeat center')}else{a9.setStyle("background",'#fefefe url("'+bc.src.replace(/_[a-z]\.jpg|\.jpg/,"_b.jpg")+'") no-repeat center')}a9.setStyle("background-size","100%");bc.width=a5[0];bc.height=aF;bc.scaled=true;bn+=Math.floor(a5[0])+(bj>0?d:0)}else{a9.removeAttribute("data-upscaled");bn+=Math.floor(a5[0]*a0)+(bj>0?d:0)}bc.height=aF;bc.width=Math.round(a5[0]*a0);a6.push(bc);if(a8.hasClass("page-break")&&a1!==0&&u){var aX=ad.Node.create('<div class="breaker"><p>Page '+a8.getAttribute("data-page-num")+"</p></div>");a8.insert(aX,"before");bn+=aL;a3.hasBreaker=true}if(a3.hasBreaker){bq=bo-aL}else{bq=bo}var bl=false;if(bn>=bq){a1++;a0=bq/bn;aZ=aF;var a2=a6.length,bk,ba,bd=0;do{++bd;bn=0;for(bg=0;bg<a2;bg++){bk=a6[bg].height;ba=a6[bg].width;bk=Math.round(bk*a0);ba=Math.round(ba*a0);a6[bg].finalHeight=bk;a6[bg].finalWidth=ba;bn+=ba+(bj>0?d:0)}bn=bn-d;if(bn-bq>=3){bl=true;a0-=0.001}else{if(bn-bq<=-3){bl=true;a0+=0.001}else{bl=false}}if(bd>=20){bl=false}}while(bl);for(bi=0;bi<a2;bi++){var bh=aw(a6[bi]),br;if(bh){a6[bi].thumbNode.set("className",["thumb",bh].join(" "))}a3.setStyle("height",bk+"px");a9=a6[bi].node.one("img.pc_img");a9.setAttribute("height",a6[bi].finalHeight);a9.setAttribute("width",a6[bi].finalWidth);br=(ad.config.flickr.flags.enable_retina_justified&&v)?a6[bi].sizes[a6[bi].current_size][1]/2:a6[bi].sizes[a6[bi].current_size][1];if(a6[bi].finalHeight>br){if(a6[bi].scaled!==true){var Y=aI(a6[bi],a6[bi].finalHeight);a9.setAttribute("data-defer-src",Y)}}}a3.setStyle("height",bk+"px");if(!a3.all(".photo-display-item").size()){a3=false}else{bp.appendChild(a3)}if(bb>0){a3=bp.create('<div class="row"></div>')}else{a3=false}bn=0;a6=[]}}if(a3){a3.addClass("extrarow");bp.appendChild(a3)}bp.setStyle("background","transparent");var aY=window.location.hash.match(/photo\_([0-9]+)/);if(aY&&!aj){var a7=k().filter('[data-photo-id="'+aY[1]+'"]');if(a7&&a7.item(0)){a7.item(0).vis.animScrollIntoView(true,5);aj=true}}window.setTimeout(function(){bp.removeClass("loading")},1);aq=bp.get("offsetHeight");O()}var aQ=(function(){var aY=null,aX=null,Y=null,aZ,a0=true;return function(){var a3;F.searchify=true;Y=Y||(Y=ad.one(".group-content-wrapper"));aY=aY||(aY=ad.one("#SubNav"));aX=ad.one(".searchified-options");if(ad.config.flickr.flags.enable_liquid_everything){a3=F.liquid.resizePage();if(a3==aZ&&!a0){return}else{aZ=(a3>=1400)?1400:a3-10}var a2=ad.one("#new_sponsor_head");if(a2){aZ=a2.get("offsetWidth")}if(!Y&&aY){aY.setStyle("width",aZ+"px")}else{if(!ad.config.flickr.flags.enable_2013_photo_page){Y&&Y.setStyle("width",aZ+"px")}}if(!ad.config.flickr.flags.enable_2013_photo_page){aX.setStyle("width",aZ+"px");var a1=ad.one("#searchified-header");a1&&a1.setStyle("width",aZ+"px")}}if(a0){aY&&aY.setStyle("opacity",1);aX&&aX.setStyle("opacity",1);a0=false}}})();function j(a4){var a1,aX,a0,Y,aZ,aY;a1=a4;if(!a1){return}aX=a1.all("li.topic");if(!aX||aX.size()<1){return}var a3=a1.one("#bottom-bit");var a2=a3.get("offsetHeight");topSpace=250;a0=ad.DOM.winHeight();Y=a0-a2-topSpace;aZ=ad.config.flickr.flags.enable_justified_groups?2:Math.floor(Y/aX.item(0).get("offsetHeight"));if(ad.config.flickr.flags.enable_justified_groups){if(aZ<2){aZ=2}else{if(ac){aZ=6}}}else{if(aZ<3){aZ=3}else{if(ac){aZ=6}}}aX.setStyle("display","none");aY=aX.slice(0,aZ);aY.setStyle("display","block");if(R==="sm"){ad.one("#pool-photos").setStyle("minHeight",parseInt(ad.one("#group-sidebar").get("offsetHeight"),10))}}function K(Y,aY){if(R==="sm"){return}aY=aY||false;aQ();if(P&&!P.shown){P.setStyle("display","block");J=true;if(P.get("offsetHeight")>Y.get("offsetHeight")){ac=true}if(window.localStorage){sidebarState=parseInt(window.localStorage.getItem(h),10);sidebarStateHashed=parseInt(window.localStorage.getItem(cacheKeyHashed),10);if(sidebarStateHashed===t||sidebarState===t){J=false;if(sidebarState){window.localStorage.removeItem(h);window.localStorage.setItem(cacheKeyHashed,t);am(false)}}else{J=true}}else{if(!window.location.pathname.match(/page/)){J=false}}if(J){P.addClass("open")}P.shown=true}if(P){if(window.innerHeight<P.get("offsetHeight")){P.addClass("short-window")}else{P.removeClass("short-window")}}if(ah(Y)&&aV()){ap(Y);return}else{if(ah(Y)&&!aV()){return}}var aZ,a0,aX,a1;aZ=Y.get("offsetWidth");if(K.cont_width===aZ&&!aY){return}K.cont_width=aZ;if(J){aZ-=aR;Y.setStyle("paddingLeft",(aR+45)+"px")}else{Y.setStyle("paddingLeft",0)}a0=aO(aZ);aX=100/a0;aX=Math.floor(100*aX)/100;if(ad.UA&&ad.UA.ie&&ad.UA.ie<8){aX=aX-0.1}aX=aX+"%";if(a0===1){Y.addClass("single-col")}else{Y.removeClass("single-col")}a1=k();f(aZ,P?"groups":null);a1.setStyle("width",aX)}if(ad.config.flickr.justify){K=ad.betterThrottle(K,40)}else{K=ad.betterThrottle(K,30)}function am(aY){var a0;try{a0=window.location.pathname}catch(aX){}a0||(a0="/groups/");var aZ=1000*60*60*24*30;var Y={domain:".flickr.com",path:a0,expires:(new Date((new Date()).getTime()+aZ))};ad.Cookie.set("grpsb",aY?"1":"0",Y)}function f(aY,Y){var aX="flsrcw";Y&&(aX+="_"+Y.slice(0,2));az(aX,aY,1000*60*60);az("rtna",window.devicePixelRatio>1?"1":"0",1000*60*60)}f=ad.betterThrottle(f,100);function az(aX,aY,aZ){if(!aX||!aY||!ad.Lang.isNumber(aZ)){return false}var Y={domain:".flickr.com",path:"/",expires:(new Date((new Date()).getTime()+aZ))};ad.Cookie.set(aX,aY,Y);return true}function k(){if(!k.memo){k.memo=aC.all(ae)}return k.memo}function aO(Y){Y=Y||aC.get("offsetWidth");return Math.floor(Y/W)}function at(){var aX,Y=[];if(ah(aC)){aC.all(".row").each(function(aZ){var aY=aZ.one(ae);if(aY){Y.push(aY)}})}else{aX=aO();k().each(function(aZ,aY){if(aY%aX===0){Y.push(aZ)}})}return new ad.NodeList(Y)}function aN(Y){var aZ,aX,aY,a0;if(!Y){return}aX=Y.get("id");if(!aX){aX=ad.guid();Y.set("id",aX)}if(!aN.regions){aN.regions={}}if(aN.regions[aX]){aZ=aN.regions[aX]}else{aZ=Y.get("region");aZ[1]-=5;aZ.bottom-=5;aZ.top-=5;aZ.height-=10;if(Y.one("img").get("complete")){aN.regions[aX]=aZ}}aY=Y.inViewportRegion(true,aZ);a0=Y.inViewportRegion(false,aZ);return[aY,a0]}function ai(aY,a3){var a7=aY,a0,aZ,a2=a7.size(),Y,a5,a4,a6,aX,a1;for(a0=0;a0<a2;a0++){if(a3){aZ=a2-a0-1}else{aZ=a0}a6=aN(a7.item(aZ));aX=a6[0];a1=a6[1];if(aX){if(ad.Lang.isNumber(Y)||ad.Lang.isNumber(a5)){a4=true}if(!ad.Lang.isNumber(Y)){Y=aZ}}else{if(a1){if(ad.Lang.isNumber(Y)||ad.Lang.isNumber(a5)){a4=true}if(!ad.Lang.isNumber(a5)){a5=aZ}}}if(ad.Lang.isNumber(Y)&&ad.Lang.isNumber(a5)&&(a4||(!aX&&!a1))){break}}return[Y,a5,a4]}function aP(a3){if(!k()||!k().size()){return false}var aX,a6,Y;var a0=at();var a5=ai(a0);var aZ=a5[0];var a1=a5[1];var a4=a5[2];var aY=s&&s.get("running")&&aP.last_move&&aP.last_move.direction==="prev";var a2=s&&s.get("running")&&aP.last_move&&aP.last_move.direction==="next";if(a3){if(aY){a6=aP.last_move.destination-1}else{if(ad.Lang.isNumber(aZ)||ad.Lang.isNumber(a1)){if(ad.Lang.isNumber(aZ)&&ad.Lang.isNumber(a1)&&a1<aZ){a6=a1}else{if(ad.Lang.isNumber(aZ)){a6=aZ-1}else{if(ad.Lang.isNumber(a1)){if(a4){a6=a1}else{a6=a1-1}}}}}}if(ad.Lang.isNumber(a6)){if(a6<0){aX=ad.one("body")}else{aX=a0.item(a6)}}}else{if(a2){a6=aP.last_move.destination+1}else{if(ad.Lang.isNumber(aZ)||ad.Lang.isNumber(a1)){if(ad.Lang.isNumber(aZ)&&ad.Lang.isNumber(a1)&&a1<aZ){a6=aZ}else{if(ad.Lang.isNumber(aZ)){a6=aZ}else{if(ad.Lang.isNumber(a1)){if(a4){a6=a1+1}else{a6=a1}}}}}}if(ad.Lang.isNumber(a6)){if(a6<a0.size()){aX=a0.item(a6);Y=aX.getY()-aX.get("docScrollY");if(Y<(10+ao)){a6=a6+1;aX=a0.item(a6)}}if(a6>=a0.size()){aX=ad.one(".Pages")||ad.one("#foot")}}}if(aX){aP.last_move={direction:a3?"prev":"next",destination:a6};m(aX,true,0.4);return true}else{return false}}function U(){if(!k()||!k().size()){return false}var aZ=at();var Y=ai(aZ,true);var a0=Y[0];var aX=Y[1];var aY=Y[2];if(ad.Lang.isNumber(a0)){if(aZ.item(a0+1)){m(aZ.item(a0+1),true);return true}else{return false}}else{if(ad.Lang.isNumber(aX)){if(aZ.item(aX+1)&&aY){m(aZ.item(aX),true);return true}else{return false}}else{return false}}}function aS(){if(!k()||!k().size()){return false}var aZ=at();var Y=ai(aZ,false);var a0=Y[0];var aX=Y[1];var aY=Y[2];if(ad.Lang.isNumber(a0)){if(aZ.item(a0-1)){m(aZ.item(a0-1),false);return true}else{return false}}else{if(ad.Lang.isNumber(aX)){if(aZ.item(aX-1)&&aY){m(aZ.item(aX),false);return true}else{return false}}else{return false}}}function m(aX,Y,aY){var a0,aZ;if(!ad.Lang.isNumber(aY)){aY=0.4}if(Y){a0=aX.getY()-5}else{a0=aX.getY()+aX.get("offsetHeight")-aX.get("winHeight")+5}a0-=ao;if(a0<0){a0=0}aZ={scroll:[0,a0]};if(!s){s=new ad.Anim({node:ad.one("window"),to:aZ,duration:aY,easing:ad.Easing.easeOut})}else{if(s.get("running")){s.stop()}s.set("to",aZ)}s.run()}m=ad.betterThrottle(m,50);function H(Y,aY){var aX;if(!ad.config.flickr.flags.enable_faves_page_flanal){return}switch(ad.config.flickr.page_type){case"faves":aX="flickr.favorites.";break;case"contacts":aX="flickr.recent_from_contacts.";break;case"contactsfaves":aX="flickr.recent_faves_from_contacts.";break}if(!aX){return}Y=aX+Y;ad.flanal(Y,aY)}function S(Y){k.memo=null;aC=Y;ah(Y,true)}ad.PhotosList=al;ad.PhotosList.reflow=K;ad.PhotosList.scrollTo=m;ad.PhotosList.destroy=S;ad.PhotosList.updateConfig=C},"0.0.1",{requires:F.config.modules[c].requires||[],optional:F.config.modules[c].optional||[]})}());YUI.add("html5-balls",function(d){var b='<div class="html5-balls"><div class="blueball"></div><div class="pinkball"></div></div>';if(d.UA.ie&&d.UA.ie<9){b='<div class="html4-balls"></div>'}var c={width:{value:24},node:{validator:function(e){if(e.one){return true}else{return false}}}};var a=function(e){this.set("node",e.node);this.set("width",e.width);var f=this.get("node");var g=f.create(b);g.setStyle("width",this.get("width"));f.set("innerHTML",b)};d.augment(a,d.Attribute);d.Balls=a},"0.0.1",{requires:F.config.modules["html5-balls"].requires||[],optional:F.config.modules["html5-balls"].optional||[]});YUI.add("flickr-dialog-infinite-spinner",function(d){var a='<span class="hballs"><img src="/images/progress/balls-24x12-white.gif"></span><span class="spinner-msg">{message}</span>';d.FlickrDialog.InfiniteSpinner=function(e){var g={message:"",dialogClass:"flickr-dialog-infinite-spinner",width:"auto",allowEscKeyToCancel:false,modal:false};e=d.mix(e||{},g);e.dialogContentHTML=d.substitute(a,e);d.FlickrDialog.InfiniteSpinner.superclass.constructor.call(this,e);var f=this.get("dialogNode").one(".hballs"),h=new d.Balls({node:f});this.on("messageChange",function(i){this.get("dialogNode").one(".spinner-msg").setContent(i.newVal)})};var b={},c={};d.extend(d.FlickrDialog.InfiniteSpinner,d.FlickrDialog.Base,b,c)},"0.0.1",{requires:F.config.modules["flickr-dialog-infinite-spinner"].requires||[],optional:F.config.modules["flickr-dialog-infinite-spinner"].optional||[]});YUI.add("history-manager",function(c){var e=window,k=e.location,b=e.history,h=(b.pushState&&b.replaceState),s=!h&&(c.UA.gecko>=1.92),x={},v,z,a,o={photo:true,faves:true,group_pool:true,gallery:true,contacts:true,contactsfaves:true,photostream:true,explore:c.config.flickr.flags.enable_justified_explore?true:false},j=o[c.config.flickr.page_type]&&(h||s);function w(){if(!j){return}f();if(h){e.addEventListener("popstate",y,false)}else{if(s){e.addEventListener("hashchange",d,false)}}r(z)}function t(A){c.log("setState","info","history-manager");if(!v){v=A}z=A}function n(){var J,C,H,D,A,K,L,I,E,M,B={},G;J=c.urls.regexes[c.config.flickr.page_type];C=J&&J.exec(k.pathname);if(C instanceof Array){switch(c.config.flickr.page_type){case"photo":if(C[1]&&C[2]){if(C[3]==="photostream"){a=true}H=C[1];D=C[2];A=C[3]||"photostream";L=C[4]||((k.search.indexOf("page=")>-1)?k.search.split("page=")[1].split("&")[0]:undefined)||1;I=C[5]?true:undefined;E=C[6]?true:undefined;if(H){B.pathalias=decodeURIComponent(H)}if(D){B.photo_id=D}if(A){B.context_id=decodeURIComponent(A)}if(L){B.page=L}if(I){B.lightbox=I}if(E){B.tour=E}}break;case"faves":if(C[1]){H=C[1]&&decodeURIComponent(C[1]);from=C[2]&&decodeURIComponent(C[2]);L=C[3];D=C[4];I=C[5]?true:false;view_mode=C[6];if(H){B.pathalias=H}if(from){B.from=from}if(L){B.page=L}if(D){B.photo_id=D}if(I){B.lightbox=I}if(view_mode){B.view_mode=view_mode}}break;case"group_pool":if(C[1]){group_id=C[1];K=C[2];D=C[3];L=C[4];I=C[5]?true:undefined;view_mode=C[6];if(group_id){B.group_id=decodeURIComponent(group_id)}if(K){B.owner_id=decodeURIComponent(K)}if(D){B.photo_id=D}if(I){B.lightbox=I}}break;case"gallery":if(C[1]&&C[2]){H=C[1];M=C[2];D=C[3];I=C[4]?true:undefined;if(H){B.pathalias=decodeURIComponent(H)}if(M){B.gallery_id=decodeURIComponent(M)}if(D){B.photo_id=D}if(I){B.lightbox=I}}break;case"photostream":if(C[1]){H=C[1];D=C[3];L=C[2];I=C[4]?true:undefined;if(H){B.pathalias=decodeURIComponent(H)}if(L){B.page=C[1]}if(D){B.photo_id=D}if(I){B.lightbox=I}}break;case"contacts":L=C[1];D=C[2];I=C[3]?true:undefined;if(L){B.page=C[1]}if(D){B.photo_id=C[2]}if(I){B.lightbox=I}break;case"explore":G=C[1];D=C[2];I=C[3];if(G){B.date=G}if(D){B.photo_id=D}if(I){B.lightbox=I}break;default:D=C[1];I=C[2]?true:undefined;if(D){B.photo_id=D}if(I){B.lightbox=I}break}}return B}function f(){t(n())}function g(C){var B="",A={};switch(c.config.flickr.page_type){case"photo":B+="/photos/"+C.pathalias+"/"+C.photo_id+"/";if(C.context_id&&(a||C.context_id!=="photostream")){B+="in/"+C.context_id+"/"}if(C.page>1){B+="page"+C.page+"/"}else{if(C.lightbox){B+="lightbox/"}else{if(C.tour||v.tour){B+="tour/"}}}break;case"faves":if(C.pathalias){A.path_alias=C.pathalias}if(C.from){A.from=C.from}if(C.page){A.page=C.page}if(C.photo_id){A.photo_id=C.photo_id}if(C.lightbox){A.lightbox=C.lightbox}B=c.urls.get("faves",A);break;case"group_pool":B+="/groups/"+C.group_id+"/pool/";if(C.owner_id){B+=C.owner_id+"/"}if(C.photo_id){B+="with/"+C.photo_id+"/"}if(C.lightbox){B+="lightbox/"}break;case"gallery":B+="/photos/"+C.pathalias+"/galleries/"+C.gallery_id+"/";if(C.photo_id){B+="with/"+C.photo_id+"/"}if(C.lightbox){B+="lightbox/"}break;case"contacts":B+="/photos/friends/";if(C.photo_id){B+="with/"+C.photo_id+"/"}else{if(c.config.flickr.flags.enable_justified_contacts_photos&&C.page>1){B+="page"+C.page+"/"}}if(C.lightbox){B+="lightbox/"}break;case"photostream":B+="/photos/"+C.pathalias+"/";if(C.photo_id){if(c.listData&&c.listData.is_public_view){B+="public/with/"+C.photo_id+"/"}else{B+="with/"+C.photo_id+"/"}}if(C.lightbox){B+="lightbox/"}break;case"explore":B+="/explore";if(C.date){B+="/"+C.date}if(C.photo_id){B+="/with/"+C.photo_id}if(C.lightbox){B+="/lightbox"}break;case"contactsfaves":B+="/photos/contacts/favorites/";if(C.photo_id){B+="with/"+C.photo_id+"/"}if(C.lightbox){B+="lightbox/"}break}return B}function i(C,B){var A;for(A in C){if(C.hasOwnProperty(A)){if(!B.hasOwnProperty(A)||B[A]!==C[A]){return false}}}for(A in B){if(B.hasOwnProperty(A)){if(!C.hasOwnProperty(A)||C[A]!==B[A]){return false}}}return true}function p(D,B){c.log("pushState","info","history-manager");var C,E,A;B=B||{};C=B.replace;E=c.Lang.isString(B.title)?B.title:e.document.title;A=g(D);if(i(D,z)){return}t(D);if(h){if(C){b.replaceState(D,E,A)}else{b.pushState(D,E,A)}m()}else{if(s){x[A]=D;if(A===k.pathname||A===k.pathname+"/"){A=""}if(!A&&!q()){}else{if(!A){A="/"}if(C){k.replace("#"+A)}else{k.assign("#"+A)}}m()}}}function r(B,A){var C;A=A||{};C=A.title;p(B,{replace:true,title:C})}function u(){var A,B={};if(z){for(A in z){if(z.hasOwnProperty(A)){B[A]=z[A]}}}return B}function q(){var A=k.href.indexOf("#");if(A===-1){return""}return k.href.substr(A+1)}function m(){c.fire("historyManager:change",u())}function y(A){c.log("handlePop","info","history-manager");l(A.state)}function d(B){var A=q();if(A==="/"){A=k.pathname}l(x[A])}function l(B){c.log("handleStateChange","info","history-manager");var A;if(!B){B=n()}if(!i(B,z)){A=true}if(A){t(B);m()}}w();c.historyManager={enabled:j,pushState:p,replaceState:r,getState:u,setState:t,getStateFromUrl:n,setStateFromUrl:f}},"0.0.1",{requires:F.config.modules["history-manager"].requires||[],optional:F.config.modules["history-manager"].optional||[]});YUI.add("infinite-scrolling-transjax",function(a){a.transjax.add("infinite-scrolling",{loading:'Fetching more photos...',funny_load_0:'Wait for it...',funny_load_1:'So many photos!',funny_load_2:'More photos? No problem!',funny_load_3:'Moooooore photos!',funny_load_4:'Configuring Tuna Blaster...',funny_load_5:'Thinking...',funny_load_6:'Unloading more kittens...'})},"0.0.1",{requires:F.config.modules["infinite-scrolling-transjax"].requires||[]});(function(){var a="infinite-scrolling";YUI.add(a,function(c){var r,t,l,b,h={},s,y="data-page-count",g=0,n=0,f,j,k=c.transjax.get("infinite-scrolling","loading"),i=4,w=[],e,x,q=false,d=2500;function o(z,A,E){if(c.UA.ie&&c.UA.ie<9){return}var B,D;D=c.one("#paginator-module .this-page");if(!D&&(!E||E<=1)){return}if(c.Lang.isString(z)){r=c.one(z)}else{r=z}x=A||1;t=c.config.flickr.page_type;l=c.urls.parse(t,location.pathname+location.search);if(!l.page){l.page=1;if(D){l.page=parseInt(c.one("#paginator-module .this-page").get("innerHTML"))}}n=l.page;f=c.one("a.Prev");j=n;B=r.one(".photo-display-item");if(B){B.addClass("page-break").setAttribute("data-page-num",l.page);h[l.page]={node:r.one(".photo-display-item")}}u();e=new c.FlickrDialog.InfiniteSpinner({message:k});for(var C=0;C<7;C++){w.push(c.transjax.get("infinite-scrolling","funny_load_"+C))}if(c.rapidTracker){c.rapidTracker.beacon("thumbs_v",{num:r.all(".photo-display-item").size()})}c.later(500,this,p)}function v(B,C,J){var E=c.Node.create(C.responseText),L=J.page,A=E.one(".photo-display-item"),I;if(A){A.addClass("page-break").setAttribute("data-page-num",L);r.append('<span id="pagebreak-'+l.page+'" style="height:0;width:0;"></span>');var z=E.all(".photo-display-item");var K=z.size();r.append(z);var G=c.one("#paginator-module a.Next"),M=E.one("#paginator-module a.Next");if(G&&M&&t!=="group_pool"){G.set("href",M.get("href"))}else{if(G&&!M){G.remove()}}if(f&&t!=="group_pool"){if(j){I=j}else{I=E.one("#paginator-module a.Prev");if(I){I=I.get("href").match(/page=([0-9]+)/);if(I){I=I[1]}else{I=6}}else{I=6}}I=(I-5>1)?I-5:1;c.one("#paginator-module a.Prev").set("href",c.urls.get(t,{page:I,path_alias:l.path_alias}))}if(window.location.search=="?profile=1"){for(var H=0;H<100;H++){c.PhotosList.reflow(r)}}else{c.PhotosList.reflow(r)}var D=E.one(".Pages");if(D){s=parseInt(E.one(".Pages").getAttribute(y))}else{s=0}c.deferImages(r.all("img.defer"),{threshold:c.DOM.winHeight()});if(c.config.flickr.flags.view_count_on_visible){c.ViewCount.onVisible("img.view-count-on-visible")}h[L]={node:A};if(c.rapidTracker){c.rapidTracker.beacon("thumbs_v",{num:K})}}b=false;e.hide();c.all("#paginator-module, #foot-extras, #foot").setStyle("display","block")}function p(){var A;var z=c.one(".Pages");if(!b){++g;b=true;if(x>1&&j>1){if(!q){l.page=((l.page-1)*x)+2;q=true}else{l.page++}}else{l.page++}if(l.page>s){return}if(Math.random()<0.2){e.set("message",w[Math.round(Math.random()*6)])}else{e.set("message",k)}e.show();c.all("#paginator-module, #foot-extras, #foot").setStyle("display","none");l.photo_id=null;A=c.urls.get(t,l);if(A.match(/\?/)){A=A+"&fragment=1"}else{A=A+"?fragment=1"}c.io(A,{on:{success:v},arguments:{page:l.page}})}}function m(){var B,A,z;B=document.documentElement.scrollHeight;z=document.documentElement.clientHeight;A=window.pageYOffset;if(B-(A+z)<d&&(g<i&&n<s)){c.later(0,this,p)}}function u(){c.later(500,this,m,null,true)}c.infiniteScrolling={init:o,setLoadingMessage:function(z){k=z}}},"0.0.1",{requires:F.config.modules[a].requires||[],optional:F.config.modules[a].optional||[]})}());YUI.add("nav-selecta-rapid",function(b){var a={search:/\/search\/\?q=.+/i,search_my_photos:/\/search\/\?w=[0-9]+\@N[0-9]+\&q=.+/i,search_my_contacts:/\/search\/\?w=contacts\&q=.+/i,search_groups:/\/search\/groups\/\?q=.+/i,search_users:/\/search\/people\/\?m=names&q=.+/i,contact_photostream:/^\/photos\/[a-z]+\/?/i};b.on("NavSelecta:beforeNavigatingAway",function(d){var c;if(d.indexOf("?")===-1&&d.indexOf("/photos/")!==0){b.rapidTracker.beaconClick("searchform",d);return}if(d.indexOf("/photos/me")===0){b.rapidTracker.beaconClick("searchform","my_photostream");return}for(c in a){if(a.hasOwnProperty(c)){if(d.match(a[c])){b.rapidTracker.beaconClick("searchform",c);return}}}})},"0.0.1",{requires:F.config.modules["nav-selecta-rapid"].requires||[]});